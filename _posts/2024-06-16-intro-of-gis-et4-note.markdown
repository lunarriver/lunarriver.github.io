---
layout: post
title:  "地理信息系统概论(第四版)笔记"
date:   2024-06-16 11:43:08 +0800
---

![img](../../../assets/intro-of-gis-et4-note/书皮.jpg)

* 目录
{:toc #markdown-toc}

## 第1章 导论

地理信息系统（Geographic information system），简称GIS。

### 1.1 地理信息系统的基本概念

#### 1.1.1 数据与信息

##### 1.1.1.1 数据与信息的基本概念

**数据**：记录下来的用以定性或定量描述事物的特征和状况的资料；

**信息**：主体与外部客体之间一种相互联系的形式，是主体和客体之间一切有用的消息或知识，是一种表述事物特征的普遍形式。

数据是信息的**载体**；信息是数据的**内容**。

##### 1.1.1.2 数据处理与数据解释

**数据处理**：对数据进行收集、筛选、排序、归并、转换、存储、检索、计算，以及分析、模拟和预测等操作。

**数据解释**：通过人们的思想意识，还原出数据之中蕴含的信息，以此来认识世界，提供判断与决策的依据。

#### 1.1.2 地理信息与地理信息系统

##### 1.1.2.1 地理信息

**地理信息**是地理空间数据所蕴含和表达的地理含义。

**地理空间数据**，又称空间数据（spatial data），是与地理环境要素有关的物质的数量、质量、分布特征、联系和规律等的数字、文字、图像和图形等的总称。

地理信息的特征：（1）空间特征；（2）属性特征；（3）时序特征；

##### 1.1.2.2 地理信息系统

（1）GIS是一种计算机系统；

（2）GIS的操作对象是空间数据；

（3）GIS的技术优势在于它方便的空间数据存储能力、有效的数据集成能力、...

（4）GIS与地理科学（geography）和测绘科学（surveying and mapping）有着密切的关系；

##### 1.1.2.3 地理信息系统的特点及其分类体系

（1）按研究范围分类：全球GIS、区域GIS、国家GIS；

（2）按数据模型分类：矢量GIS、栅格GIS、矢-栅混合GIS；

（3）按研究内容分类：专题GIS（地籍、官网、人口等）、综合GIS（城市、省级、数字地球等）；

### 1.2 地理信息系统基本构成

GIS的五个基本构成：

（1）系统硬件：对应第2章；

（2）系统软件：对应第2章；

（3）空间数据：对应第3~9章；

（4）应用模型：对应第10~15章；

（5）应用人员：对应第1章；

#### 1.2.1 系统硬件

GIS硬件用来存储、处理、传输和显示空间数据。

#### 1.2.2 系统软件

GIS软件是整个系统的**核心**，用于执行GIS功能的各种操作，包括数据输入、处理、数据库管理、空间分析和数据输出等。

#### 1.2.3 空间数据

空间数据是GIS的操作对象，由它具体地描述地理现象的空间特征、属性特征、时间特征。

#### 1.2.4 应用模型

GIS应用模型是为某一特定的实例工作而建立的，运行在GIS中的分析方法和解决方案。

#### 1.2.5 应用人员

GIS应用人员包括空间数据采集人员、系统开发人员和GIS的最终用户。

### 1.3 地理信息系统的功能与应用

#### 1.3.1 地理信息系统基本功能

##### 1.3.1.1 空间数据的获取与编辑

GIS的数据通常归纳为不同性质的主题或数据层，一个主题就是一层数据。

数据获取功能：把各层空间实体转化为空间坐标及属性对应的代码输入到计算机中。

数据编辑功能：去除数据中可能存在的错误，保证数据的准确性、精确度。

##### 1.3.1.2 空间数据处理与变换

数据处理的必要性：保证系统数据的规范和统一。

数据处理的主要任务：

（1）数据变换：变换数据的数学形态；

（2）数据重构：变换数据的几何形态；

（3）数据选取：从全集合到子集的按条件提取；

##### 1.3.1.3 空间数据存储与管理

空间数据的两种主要的数据存储与管理方式：（1）文件；（2）数据库；

##### 1.3.1.4 空间分析与统计

空间分析与统计的特点：能够确定空间实体之间的空间关系，发现空间实体所具有的新的地理信息。

常用的空间分析有：（1）地形分析；（2）叠置分析；（3）邻近分析；（4）路径分析；（5）统计分析。

##### 1.3.1.5 应用建模与编程

应用建模指的是：使用各种空间分析工具，构建一个解决实际问题的GIS程序。

##### 1.3.1.6 地图制作与输出

GIS处理和分析的结果可以直接输出供专业规划或决策人员使用，其中，地图图形输出是主要表现形式。

#### 1.3.2 地理信息系统应用领域

##### 1.3.2.1 资源管理

资源管理具体包括：森林和矿产资源的管理、野生动植物的保护、土地资源利用评价，以及水资源的时空分布特征研究。

GIS的主要任务是将各种来源的数据和信息有机地汇集在一起，在统一的方式下管理大量的地理数据库。

##### 1.3.2.2 区域规划

城市与区域规划具有高度的综合性，涉及资源、环境、人口、交通、经济、教育、文化和金融等因素。

比如，规划人员使用GIS对交通流量、土地利用和人口数据进行分析，预测将来的道路等级。

##### 1.3.2.3 国土监测

利用GIS功能结合多时相的遥感数据，可以有效地进行森林火灾的预测预报、洪水灾情监测、淹没损失估算、土地利用动态变化分析和环境质量的评估研究。

##### 1.3.2.4 辅助决策

GIS拥有的数据和因特网传输技术，可以深化电子商务的应用，满足企业决策多维性的需求。

比如，企业的分布、客货源、市场的地域规律、原料、运输、跨国生产、跨国销售等。

### 1.4 地理信息系统的发展概况

#### 1.4.1 第一阶段——技术创新

GIS肇始于20世纪60年代初，表现为计算机制图技术的不断进步，到GIS的技术创新。

第一阶段延续至20世纪70年代末，其间，人们对GIS的认知体现在**GIS技术**方面。

##### 1.4.1.1 理论发展

克里金插方法、反距离加权的插值方法，产生于这一时期。

国际地理联合会（IGU）于1970年在加拿大渥太华举办了第一届会议——GIS1970。

##### 1.4.1.2 技术与应用发展

1963年，第一个计算机上运行的地理信息系统产生：加拿大地理信息系统（CGIS）。该系统初步确立了：地图坐标数据的计算机存储、空间拓扑关系的表达和地图叠置的算法实现等。

1964年，哈佛大学建立了计算机图形学与空间分析实验室。该实验室先后开发了一系列影响巨大的著名GIS软件：SYMAP、CALFORM、SYMVU、GRID和ODYSSEY等。

1969年，ESRI公司在美国创立，GIS从学术界进入IT领域。1978年，ESRI开发了第一版ArcInfo软件，是当时最先进的GIS商用软件。

1977年，美国地质调查局开发了：数字线划图（DLG）、数字栅格图（DRG）、数字正射影像图（DOQ）和数字高程模型（DEM）等空间数据格式。

#### 1.4.2 第二阶段——科学引领

20世纪80年代初，地理信息科学（GIScience）被提出。

该阶段延续至20世纪90年代中期，人们对GIS的认知提升到了**地理信息科学**的层次。

##### 1.4.2.1 理论发展

各种空间分析算法在该阶段被提出，如基于栅格数据的数字地形分析、水文分析算法等。1990年，地图代数的概念被提出。

该阶段发行了一些GIS领域的学术期刊，1987年首次发刊的《国际地理信息科学期刊》称为了GIS领域最具影响力的学术期刊。

1992年，加利福利亚大学提出了地理信息科学的概念。

1994年，开放地理信息系统联盟（OGC）创立。

这一时期，中国成立了与GIS相关的国家实验室。

##### 1.4.2.2 技术和应用发展

1987年，ESRI的PC ArcInfo发布，这是第一款在个人计算机上运行的商用GIS软件。

1991年，ESRI开发出个人计算机上基于图形用户界面（GUI）的GIS软件ArcView GIS。

1995年，ESRI发布空间数据库引擎。

#### 1.4.3 第三阶段——服务至上

从20世纪90年代后期至今，GIS借助网络的发展，真正称为无处不在的高科技手段，为社会方方面面提供了优质高效的信息服务。

人们对于GIS的认知进一步提升到**地理信息服务**的层次。

##### 1.4.3.1 理论发展

1998年，美国副总统提出**数字地球**的概念：通过互联网、虚拟现实和GIS技术，把各种空间数据整合进一个大系统，提供全方位的地理空间信息服务。

2006年，开源空间信息基金会（OSGeo）成立，该组织每年主持的自由与开放源代码地理空间软件（FOSS4G）会议在GIS领域是一个重要的事件。

##### 1.4.3.2 技术和应用发展

1997年，ESRI发布了在互联网上进行地图和空间数据数据发布的商用服务软件IMS。同年，美国明尼苏达大学开发了MapServer，实现了开源环境下的空间数据网络应用。

1999年，ARCGIS8.0发布。

2001年，PostGIS发布，实现了开源数据库PostgreSQL对空间数据存储与处理能力的支持。

2002年，QGIS发布，它是当前开源GIS领域的代表性软件。

2005年，谷歌发布了谷歌地球软件，它是数字地球的代表性软件。

该时期，中国的GIS技术赶上了国际GIS发展的步伐，并在多个应用领域处于领先地位。有关机构先后开发出了一批具有国际先进水平的GIS软件产品，如MapGIS、GeoStar、SuperMap等。

## 第2章 GIS硬件与软件

### 2.1 系统硬件

GIS硬件用来存储、处理、传输和显示空间数据。

#### 2.1.1 数据处理设备

##### 2.1.1.1 个人计算机

##### 2.1.1.2 工作站计算机

##### 2.1.1.3 客户/服务器系统

#### 2.1.2 数据输入设备

数据输入设备的作用是：将地理信息转换成数字的形式存入计算机，以便进行处理和分析计算。

##### 2.1.2.1 图形手扶跟踪数字化仪

图形手扶跟踪数字化仪，简称**数字化仪**，它可以把纸质地图上描述的各种地图符号在地图上的位置坐标计算出来，传送并存储到计算机中。

![img](../../../assets/intro-of-gis-et4-note/数字化仪.jpg)

##### 2.1.2.2 工程扫描仪

工程描述仪的作用是扫描纸质地图，将其变成高分辨率真彩色数字图像存入计算机。

![img](../../../assets/intro-of-gis-et4-note/工程扫描仪.webp)

##### 2.1.2.3 数字测量设备

数字化仪、工程扫描仪都是间接的输入设备，它们都依赖于既有的纸质地图。而数字测量设备则是直接的输入设备，它用于在野外进行地理数据的实地采集，并可制作成地图。

数字测量设备包括：

（1）**全球导航卫星系统**（GNSS）：由地球上空的卫星、监控卫星的地面站和用户接收机组成。既有的GNSS包括：美国的GPS、中国的北斗、俄罗斯的格洛纳斯、欧洲的伽利略。

（2）**激光雷达**（LiDAR）：激光探测及测距系统系统的简称，又称激光扫描仪。它是一种集成激光、GNSS、惯性导航系统三种技术于一身的综合性系统，它将**激光束打在物体上，推导出准确的空间坐标**，进而生成精确的数字地面模型（DSM）、数字高程模型（DEM）。目前，较高精度的地形测量工作**主要通过**激光雷达来进行。

（3）**全站仪**：即全站型电子测距仪，是一种集成水平角、垂直角、距离（斜距、平距）、高差测量功能于一体的测绘设备，在地形测量和工程测量中广泛使用。

#### 2.1.3 数据输出设备

数据输出设备的作用是：提供用户操作界面，把GIS最终分析、计算、处理的结果以文字、报表或统计图的形式展现给用户。

##### 2.1.3.1 绘图仪

绘图仪包括两种：

（1）笔式绘图仪：由计算机发出绘图指令，驱动电机带动话比在平面上绘制线条进行制图。

（2）喷墨绘图仪：采用碰头将图像喷洒到图纸上。

##### 2.1.3.2 显示器和投影仪

##### 2.1.3.3 打印机

### 2.2 系统软件

#### 2.2.1 基础支撑软件

##### 2.2.1.1 操作系统

Windows系列操作系统、UNIX/Linux系列操作系统、嵌入式操作系统。

##### 2.2.1.2 编程开发工具

ArcGIS等基础软件平台使用C++开发。

GeoServer等基于互联网的地图服务软件使用Java开发。

GIS支持使用Python语言进行应用模型建模。

GIS在处理数据数据时需要借助于SQL语言。

##### 2.2.1.3 数据库管理系统

数据库管理系统支持存储GIS空间数据，比如：微软SQL Server有Spatial，Oracle有Spatial and Graph，PostgreSQL有PostGIS。

#### 2.2.2 GIS功能软件

##### 2.2.2.1 GIS功能软件分类

GIS功能软件通常分为：(1)GIS基础软件平台；（2）GIS应用软件。

GIS基础软件平台一般指具有丰富GIS专业功能的通用型GIS软件。

GIS基础软件平台的代表产品：

（1）国外的桌面型系统：ArcGIS、MapInfo、Idrisi、QGIS、GRASS GIS；

（2）国外的服务器型系统：ArcGIS Server、GeoServer、MapServer；

（3）国产的桌面型系统：SuperMap、MapGIS、GeoStar，它们均有相应的服务器版本；

##### 2.2.2.2 GIS基础软件平台功能

GIS基础软件平台一般包含以下几项主要功能：

（1）空间数据输入与编辑；

（2）空间数据存储与管理；

（3）空间数据处理与分析；

（4）空间数据输出与发布；

（5）图形用户界面；

（6）建模与系统开发功能；

##### 2.2.2.3 常用GIS基础软件平台

ArcGIS：ESRI的核心产品，GIS软件市场份额最大的一款软件，也是GIS行业的标志性产品。

开源自由软件：GRASS GIS、SAGA GIS、QGIS。

国产GIS平台软件：GeoStar、MapGIS、SuperMap。

## 第3章 空间数据——坐标参考系

### 3.1 地理坐标系

GIS中所使用的**地理空间**概念，一般指上至大气电离层，下至地壳与地幔交界的莫霍面之间的地球表层空间区域，其间是自然地理过程和生命及人类活动最活跃的场所。

用来定义空间实体在地理空间中的坐标的坐标系叫作**地理坐标系**。地理坐标系以**经纬度**来定义，经纬度坐标通常以大地测量(geodetic survey)方式获得。

**大地测量**通常先要测定一些高精度的测量控制点(control point)组成测量控制网，然后再通过各种测量仪器以控制点为参照点，去测量地球表面任意地点的坐标。

#### 3.1.1 平面大地测量基准

地理坐标系以**平面大地测量基准**(horizontal geodetic datum)作为地球表面位置的测量依据。不同的地理坐标系有不同的平面大地测量基准。
每一个平面大地测量基准通常都包括：椭球体(ellipsoid)的**几何定义**、球体的**定位和定向**等内容。

##### 3.1.1.1 椭球体的几何定义

椭球体是用来表示地球大小和形状的几何模型，人们尽可能地使其逼近大地水准面的形状和大小。

定义旋转椭球体的几个参数:

（1）**长半轴**(semi-major axis)的长度a，对应地球的赤道(equator)半径。

（2）**短半轴**(semi-minor axis)的长度 b。对应球心到南(北)极的极半径(polar radius )。

（3）**扁率**(flattening)：(a-b)/a，表示长半轴相比于短半轴超出的比例。

##### 3.1.1.2 椭球体的定位和定向

椭球体的定位和定向：让椭球体和实际地球的大地水准面**尽量贴合**。

（1）**局部定位**：通过设定大地原点(origin)建立局部区域的地理坐标系。在大地原点的位置，球体表面和局部大地水准面的表面相贴合，它是用来推算其他位置经纬度坐标的初始参照点。

（2）**地心定位**：将球体的球心和地球的质量中心(质心)相重合，建立全球测量的地理坐标系。

**定向**：设定椭球体坐标轴的方向。以椭球体的圆心为原点，z轴指向某一时间测定的地极方向，x轴的指向与本初子午线所在平面平行且垂直于z轴。y轴垂直于x轴和z轴，形成右手坐标系。

| 采用时间 | 大地测量基准地理坐标系  | 椭球体名称 | 长半轴 a/m | 扁率的倒数 1 | 定位 | 定向 |
| ------- | --------------------  | --------- | ---------  | ----------- | ---- | ---- |
| 1954年-1980年  | 1954北京坐标系 | 克拉索夫斯基 | 6 378 245 | 298.3 | 局部定位（列宁格勒） | |
| 1980年-2008年  | 1980 西安坐标系 | IAG1975 | 6 378 140 | 298.257 0 | 局部定位（陕西泾阳） | 参心坐标系 |
| 2008年-现在  | 2000国家大地坐标系 | CGCS2000 | 6 378 137 | 298.257 222 101 | 地心定位 | 地心坐标系 |

#### 3.1.2 大地测量坐标系

**大地测量坐标系**：按照平面大地测量基准定义的地理坐标系。

**大地经度**：经过地面上某点的子午线平面与本初子午线(经度为0度)平面之间张开的角度，本初子午线以东为正值，以西为负值;

**大地纬度**：经过地面上某点且垂直于球体表面的直线与赤道(纬度为0度)平面之间的夹角，赤道以北为正值，以南为负值。

由于在不同历史时期我国测绘的标准地形图上采用了不同的大地测量坐标系，即1954北京坐标系、1980西安坐标系和2000国家大地坐标系，因此造成了相同地点的大地经纬度坐标在不同大地测量坐标系下存在**微小的差异**。

所以，在GIS中使用不同的大地测量坐标系的空间数据时，需要把它们转换成基于相同的大地测量基准的坐标数据。

### 3.2 垂直坐标系

**垂直坐标系**用来测量地球表面上的某一点相对于垂直大地测量基准(vertical geodetiedatum)的高度位置坐标。该坐标表示该点高于或低于某一基准面的垂直距离，常称为**高程**。

#### 3.2.1 垂直大地测量基准

**椭球面高**：以椭球体的表面作为垂直基准，测量地球表面上的某一点到椭球体表面的垂直高度，又称大地高；

**大地水准高**：以大地水准面为垂直基准，获得地球表面上的一点到大地水准面的垂直高度，又称正高；

由于大地水准面在海洋上通常是平均海水面，因此，大地水准高又称为海拔高度，简称**海拔**。

在制定垂直大地测量基准时，通常以本国某一处或多处的平均海水面高度作为各自统一的大地水准面高度。一般取**海边某个验潮站**对海水面高度多年观测结果的数值，该数值定为高程0m。

#### 3.2.2 高程坐标系

**高程坐标系**：以垂直大地测量基准建立的测量高程的坐标系统。常用的高程坐标系是以大地水准面为基准的。

**1956年黄海高程系**：采用了青岛验潮站1956年之前的观测资料推算的黄海平均海水面的高度作为全国统一水准测量的基准面。

**1985国家高程系**：采用了青岛验潮站1953年至1979年积累的验潮资料，这是当前我国使用的高程坐标系。

### 3.3 投影坐标系

地理坐标系在实际应用中并不方便，例如，在计算距离、长度、方向和面积等几何特性的时候，若使用经纬度坐标计算，则**计算方法相对复杂**，而若使用平面坐标系的坐标来计算则较为简单。

因此，通常采用地图投影的数学方法，把基于经纬度的地理坐标系变换成平面的投影坐标系。

#### 3.3.1 地图投影

##### 3.3.1.1 地图投影的原理

地图投影的原理就是要在地理坐标系的经纬度坐标与平面投影坐标系的坐标之间建立起**一一对应的函数关系**。

##### 3.3.1.2 地图投影的变形

所谓地图投影的**变形**，指的是经过地图投影变换后的空间实体，其在平面上的几何特征与原来在椭球体曲面上形状的**几何特征发生的改变**。

主要有三种变形：

（1）**角度变形**：原来在椭球体表面上某个角度测量的数值，与该角度经过地图投影后在平面上测量所得的数值存在的差异。

（2）**长度变形**与**面积变形**：椭球体表面和地图表面上测量长度和面积所得数值之间的差异。

**任何一种地图投影都存在变形**，完全没有变形的地图投影是不存在的。

##### 3.3.1.3 地图投影的分类

1、按照投影变形性质分类

（1）**等角投影**：形状无变化，大小可能变化，又称正形投影。

（2）**等距离投影**：形状可能变化，但大小不变。

（3）**等面积投影**：形状可能变化，但面积不变。

（4）**任意投影**：形状变化，大小也变化。

2、按照投影面几何形状分类

投影面指的是一种可以用来辅助地图投影的、能够展开成平面的简单几何表面。

（1）**圆锥面**：采用圆锥面作为投影面的地图投影称为圆锥投影(eonicprojection)。圆锥投影的投影面像一把撑开的伞罩在参考椭球体上，投影的时候先把参考椭球体表面上的空间实体的形状投影到圆锥面上，再把圆锥面沿着一条母线剪开，把圆锥面展开成一个扇形，在这个扇形上面的空间实体的形状就是其圆锥投影的图形。

（2）**圆柱面**：采用圆柱面作为投影面的地图投影称为圆柱投影(cylindricalprjection)。圆柱投影通常是把参考椭球体表面先投射到圆柱面上，再把圆面沿着一条母线剪开，展开成一个矩形，从而得到圆柱投影的图形。

（3）**平面**：采用平面作为投影面的地图投影称为方位投影(azimuthal projection)。类似投影仪那样，把地球表面投射到平面上形成的投影形状。方位投影通常可以用来制作半球地图或极地地区的地图。

3、按照投影面与椭球体的位置关系分类

（1）**正轴投影**(normal projection)：投影面的旋转轴与参考椭球体的自转轴重合的投影。

（2）**横轴投影**(transverse prjection)：投影面的旋转轴与参考椭球体的自转轴垂直的投影。

（3）**斜轴投影**(obliqueprojection)：投影面的旋转轴与参考椭球体的自转轴既不重合也不垂直的投影。

4、按照投影面与椭球体接触情况分类

（1）**相切投影**：投影面和参考椭球体表面相切。

（2）**相割投影**：投影面和参考椭球体表面相割。

#### 3.3.2 常用的地图投影

##### 3.3.2.1 墨卡托投影

墨卡托投影（Mercator projection）是一种**等角正轴切圆柱投影**。没有角度变形，经纬线投影后都是平行直线，切处处相交成直角，而长度和面积变形比较显著，从赤道至两极变形逐渐增大。常用于航海图和航空图。

##### 3.3.2.2 兰勃特等角圆锥投影

兰勃特等角圆锥投影（Lambert conformal conic projection）是一种双标准纬线的**等角正轴割圆锥投影**。投影后，纬线为同心圆弧，经线为放射状的同心圆弧的半径。没有角度变形。我国1:100万地形图采用它。

阿尔伯斯等面积圆锥投影（Alberts equal-area conic projection）是一种**等面积正轴割圆锥投影**。没有面积变化。我国省级行政区地图采用它。

##### 3.3.2.3 高斯-克吕格投影

高斯-克吕格投影（Gauss-Kruger projection）是一种**等角横轴切椭圆柱投影**。没有角度变化。我国基本比例尺地图采用它。

#### 3.3.3 常用投影坐标系

投影坐标系是按照设定的地图建立的坐标系。

##### 3.3.3.1 高斯-克吕格投影坐标系

我们标准地形图采用它。由于赤道边缘处变形最大，将椭球体划分成若干投影带，分别形成各自的投影坐标系。为使坐标值均为正值，使x、y各自加上500km的伪偏移量。

##### 3.3.3.2 通用墨卡托投影坐标系

基于横轴墨卡托投影，属于横轴等角等角割圆柱投影。可以改善高斯-克吕格投影的经度。

## 第4章 空间数据——模型与结构

### 4.1 空间实体及空间数据

#### 4.1.1 空间实体及其分类

GIS中把地球表面上的各种事物和现象统称为**空间实体**（spatial entity）。如果空间实体以矢量数据表达，那么它可被称为**空间要素**（spatial feature）。

##### 4.1.1.1 离散型实体的性质

离散型实体包括：**点**（point）、**线**（line）、**面**（area）、**体**（volume）。

##### 4.1.1.2 连续型实体的性质

连续性实体可以表示**曲面**。比如，起伏的地形表面、降雨量分布的统计表面。

#### 4.1.2 空间数据及其分类

空间数据通常记录空间实体两方面的特征信息：

（1）空间实体在地球上的**位置信息**。

（2）空间实体自身具有的**属性信息**。

##### 4.1.2.1 按照数据来源分类

（1）**地图数据**：来源于各种普通地图和专题地图。

（2）**影像数据**：来源于卫星遥感和航空摄影。

（3）**文本数据**：来源于和GIS有关的调查报告、实测数据和文献资料等。

##### 4.1.2.2 按照数据模型分类

（1）**矢量数据**：用点（0维）、线（1维）、面（2维）等几何元素及其组合来表达空间实体的**空间位置**。

（2）**栅格数据**：将空间按照行和列分割成规则的网格，每个方格对应地面上一个正方形区域，保存相应的**属性数据**。

##### 4.1.2.3 按照数据特征分类

（1）**空间定位数据**：表达空间实体在地球上位置的坐标数据（经纬度或投影坐标）。

（2）**非空间数据**：表达空间实体自身的名称、种类、质量、数量等特征的数据。

##### 4.1.2.4 按照数据几何特征分类

（1）**点**：对0维空间实体的抽象，如测量用的三角点、山峰的位置点。点没有大小。

（2）**线**：对1维空间实体的抽象，如国界线。线只有长度，没有宽度。

（3）**面**：对2维空间实体的抽象，如湖泊、行政区。面既有周长，又有面积。

（4）**曲面**：对面上连续分布的空间实体的抽象，常被界定为2.5维。

（5）**体**：对3维空间体的抽象，如地质构造、建筑物。

#### 4.1.3 空间数组的组织方式

GIS中的空间数据通常从**空间**、**属性**和**时间**三个方面来组织。

##### 4.1.3.1 空间分区

空间分区指的是将研究区的空间范围划分为许多**子空间**来分别组织数据。例如，地形图就是按照一定的经纬度间隔来划分幅面的。

##### 4.1.3.2 属性分层

GIS通常是把要表达的空间数据归入不同类型的**属性数据层**来组织，每一个数据层都是某一地区相同性质的数据集合。

##### 4.1.3.3 时间分段

时间分段指的是将有时间特征的地理数据按其变化规律划分为不同的**时间段数据**，再逐一表示。不同时间的数据再GIS中常被成为数据具有不同的**时态版本**。

### 4.2 空间数据模型与空间数据结构

空间数据的数据结构，是指空间数据的坐标（矢量数据模型）或栅格单元（栅格数据模型）以什么样的形式在计算机中存储、表达的逻辑结构。

#### 4.2.1 矢量数据模型

矢量数据模型能很好地表达空间要素的空间分布特征，数据经度高，数据存储的冗余度低。

##### 4.2.1.1 实体数据结构

实体数据结构中，空间数据按照基本的空间要素（点、线、面）为单元进行单独组织，并存储各自的坐标值。

（1）**点要素**：由一个点的标识码（identifier）和一对（x, y）坐标组成。

（2）**多点要素**：由多个点要素组成，它是一个要素（而不是多个）。如长三角城市群。

（3）**线要素**：由连接一串坐标点的线段组成。常称为折线（polyline）。

（4）**多线要素**：由多个线要素组成。如一个水系的所有河流。

（5）**面要素**：由一串坐标围成的环来表示（环不能相交）。常称为多边形（polygon）。

（6）**多面要素**：由多个面要素组成。包括相邻、分离、套合（内部的面作为洞）和交叠几种情况。

##### 4.2.1.2 拓扑数据结构

拓扑（topology）指的是矢量数据中的点、线、面之间的空间联系。

（1）**点、线、面的拓扑结构**：点的数据结构与点要素相同。线和面的数据由弧段表达。

（2）**不规则三角网拓扑结构**：简称为TIN，它将离散分布的点连城三角形组成的网络，对于每个三角形，包括：标识码、相邻三角形标识码、三个顶点标识码。

（3）**道路网络拓扑结构**：包括网络数据的空间坐标数据、网络数据的拓扑结构两个组成部分。后者用邻接表来表达。

#### 4.2.2 栅格数据模型

栅格数据模型表示的是二维表面上地理要素的离散化数值，每个栅格单元对应一种属性。栅格的形状一般是正方形，其边长决定了栅格数据的精度，称为**空间分辨率**。

与矢量数据相比，栅格数据表达地理实体比较直观，容易实现多层数据的叠置操作。栅格数据的缺点是，随着空间分辨率的增加，存储空间迅速扩张，**冗余度比较大**。

##### 4.2.2.1 栅格矩阵结构

栅格矩阵结构以矩阵来存储栅格数据单元。对栅格矩阵数据的**压缩**是栅格数据结构要解决的重要任务之一。

##### 4.2.2.2 游程编码结构

游程指的是在栅格矩阵的一行内位置相邻且具有相同属性数值的栅格单元的数量。游程编码结构逐行将相邻同值的栅格单元合并，记录栅格单元的值和数量，进而消除数据间的冗余。游程编码是**无损压缩**。

## 第5章 空间数据——获取与编辑

### 5.1 空间数据获取

空间数据获取指的是得到GIS中所用的空间数据的方法。

#### 5.1.1 主要空间数据产品

##### 5.1.1.1 数字划线图

数字划线图（digital line graph，简称DLG）是一种**矢量地图数据**，主要是用矢量数据模型表达的标准地形图数据。其特点在于**分层表达**、分层存储。比如，河流存在于一个层，地形等高线存在于一个层。

存储DLG数据有三种文件格式：（1）SDTS(spatial data transfer standard)，空间数据转换标准文件格式；（2）Shapefile文件，以实体数据结构存储的矢量空间数据文件格式；（3）Geodatabase，地理数据库。

**Shapefile**是GIS实际上的空间数据文件格式标准。

##### 5.1.1.2 数字栅格图

数字栅格图（digital raster graph，简称DRG）是以**数字图像**的形式存储的地形图数据。其文件格式现在使用较多的是**GeoTIFF**图像格式。

##### 5.1.1.3 数字高程模型

数字高程模型（digital elevation model，简称DEM）用来表达地面高程的有序的数值矩阵，也可以用**GeoTIFF**图形格式存储。还可以将DEM数据显示成一种具有立体感的**三维透视场景图**（perspective view map）。

##### 5.1.1.4 数字正射影像图

数字正射影像图（digital orthophoto quadrangle 或 map，简称DOQ或DOM）通常是航空摄影得到的数字图像，即测量飞机飞到目标地区的上空，对地面进行拍照而得到。一般也以**GeoTIFF**图像格式存储。

#### 5.1.2 空间数据下载

空间数据已经由某些专业部门或企业制作好了，可在相应的网站下载。

##### 5.1.2.1 地理数据门户网站

我国的地理数据门户网站：**全国地理信息资源目录服务系统**（https://www.webmap.cn/）。

大比例尺地图涉及**国家机密**，使用数据需要遵守相关规定。

##### 5.1.2.2 空间元数据

地理数据门户网站下载的数据可在任意GIS软件中打开，并进行浏览。

**空间元数据**是用来对空间数据进行附加说明的数据，包含了空间数据的内容、质量、状态和来源等方面的信息。

#### 5.1.3 空间数据创建

地理数据门户网站的数据可能不满足需求，此时需要在GIS中创建新的空间数据。包括实地测量、遥感两种直接方法，和地图数字化、空间数据变换两种间接方法。

##### 5.1.3.1 实地测量创建空间数据

实地测量，就是使用测绘仪器（经纬仪、水准仪、全站仪、北斗或GPS接收机），到野外实地进行测量，并导入GIS。

现在使用全球导航卫星系统去测量是非常简单的。可用的全球导航卫星系统包括：美国的GPS、俄罗斯的GLONASS、欧盟的伽利略和我国的北斗。

##### 5.1.3.2 遥感创建空间数据

获取遥感数据的方法：（1）卫星对地面拍摄；（2）测量飞机对地面拍摄；（3）机载激光雷达系统扫描地图；（4）海上船舶通过多波束装置基于反射回波获得海底深度信息。

##### 5.1.3.3 地图数字化创建空间数据

基于纸质地图进行数字化的方式：

（1）手扶跟踪数字化：基于数字化仪；

（2）扫描矢量化：基于工程扫描仪；

（3）屏幕数字化：将纸质地图扫描成数字图像，再在GIS中进行基于数字图像的操作；

#### 5.1.4 几何变换

##### 5.1.4.1 几何变换方法分类

地图数字化中的地理配准是通过在两个坐标系之间进行几何变换实现的。

（1）等面积变换：在两个坐标系间进行平移、旋转。空间实体的形状和大小保持不变。

（2）相似变换：在两个坐标系间进行平移、旋转和等量缩放。形状保持不变，大小可能变化。

（3）仿射变换：在两个坐标系间进行平移、旋转、不等量缩放，以及扭曲（skew）。形状和大小均可能变化。

（4）射影变换：允许角度和长度的变形，不保持原有平行直线的平行性，但保持共线性（统计学概念）。

##### 5.1.4.2 仿射变换

仿射变换是最常用的。其变换可通过下式描述：

X = a0 + a1 * x + a2 * y

Y = b0 + b1 * x + b2 * y

使用最小二乘法来计算这6个系数。只要残差在可接受范围内，就是使用这个仿射变换。

### 5.2 空间数据编辑

#### 5.2.1 几何数据编辑

在将空间数据输入GIS之后，需要**对错误进行检查和修改**，称为空间数据编辑。

##### 5.2.1.1 定位错误与几何图形编辑

定位错误指空间位置上的错误。编辑方式：（1）重新进行地图数字化；（2）删除；（3）移动；（4）改变形状。

##### 5.2.1.2 拓扑错误编辑

拓扑错误指矢量数据的点、线、面在空间位置关系上的错误。GIS通过建立拓扑关系的规则，来进行拓扑错误的检查。

（1）拓扑关系规则指的是矢量数据点、线、面之间遵循的空间位置关系，比如等高线需要遵循不能相交的规则。矢量线常见的拓扑错误有：过头（overshoot）、未及（undershoot），它们都会产生**悬挂结点**（dangling node），这在河流、道路矢量线上非常容易出现。

（2）用户指定了拓扑规则后，GIS会自动进行拓扑检查。用户需要根据实际情况制定一个容差，也就是误差允许的范围。

（3）GIS检查出的拓扑错误，会在界面中标识出来，进而可进行修改。

##### 5.2.1.3 线的简化

采用扫描方式生成的线，通常包含着密集的矢量点，一般需要进行简化处理，即将不影响线的形状的坐标点去掉。该过程称为线简化（line simplification）或概化（generalization）。

GIS中最经典的线简化方法是：**道格拉斯——皮克算法**。

##### 5.2.1.4 几何数据更新

若原有的空间数据中的某些几何元素发生改变，则需要对几何数据进行更新。例如，一个行政区被分成了两个不同的行政区，则需要进行分割（split）；反之，则需要进行合并（merge）。

#### 5.2.2 属性数据编辑

空间定位数据仅仅说明空间实体所在的位置，而属性数据则说明空间实体的性质。GIS允许对空间实体的属性数据进行检查、修改。

## 第6章 空间数据——转换与变换

### 6.1 矢量栅格转换

矢量数据模型有空间定位精度高、数据存储量小、投影变化实现比较容易的优点。栅格数据模型在空间叠置分析与遥感数据集成分析等方面有明显优势。因此，在针对不同的应用场景时，需要在这两者之间做转换。

#### 6.1.1 矢量栅格化

##### 6.1.1.1 矢量点的栅格化

已知一个矢量点P的坐标为 (x,y)，若栅格单元的大小在x方向上是Δx，在y方向上是Δy，则其栅格行列坐标值 (Ip, Jp) 计算如下：

![img](../../../assets/intro-of-gis-et4-note/矢量点的栅格化.png)

其中，int为向下取整函数，(Xmin, Ymin)是整个栅格数据最左下角的栅格单元的左下角的矢量坐标。

##### 6.1.1.2 矢量线的栅格化

对矢量线（又称折线）进行栅格化，需要逐段分别进行。对线段进行栅格化的工作原理是：**数字微分分析法**。就是按照**一定的间距**，沿着线段找出一连串的矢量点，再利用矢量点的栅格化方法对点进行栅格化。

![img](../../../assets/intro-of-gis-et4-note/矢量线的栅格化.png)

线的栅格化可能导致栅格数据表现出**锯齿状的边缘**。

##### 6.1.1.3 矢量面的栅格化

矢量面数据仅仅存储边界上的点，其内部的点是没有存储的。在进行矢量面的栅格化时，还要把它内部的栅格单元也找到。

（1）**种子填充法**：第一步，栅格化边界线；第二步，在内部任意找一个栅格单元，称为种子；第三步，让种子往上下左右四个方向的栅格单元生成，不断迭代，直至到达边界。

（2）**逐栅格单元判别法**，即对栅格单元逐行、逐列地判别是否属于矢量面。

#### 6.1.2 栅格矢量化

栅格矢量化是矢量栅格化的逆过程。

##### 6.1.2.1 栅格点的矢量化

已知栅格单元的大小在x方向上是Δx，在y方向上是Δy，若一个栅格单元的行列坐标值为 (I, J) ，则其对应矢量点坐标 (x, y) 的计算如下：

![img](../../../assets/intro-of-gis-et4-note/栅格点的矢量化.png)

其中，(Xmin, Ymin)是整个栅格数据最左下角的栅格单元的左下角的矢量坐标。I和J都减去0.5，表明是减掉了半个栅格单元的大小，使得矢量坐标点处于栅格单元的中心位置。

##### 6.1.2.2 栅格线的矢量化

栅格线的矢量化，从其起点栅格单元开始，找到它的中心点，然后在它周围的8个相邻的栅格单元中搜索，找到相邻栅格单元中属性值也是这条栅格线的栅格单元，然后就会跟踪走到这个新的栅格单元中心点位置。然后循环往复，直至终点栅格单元结束。把全部的中心点位置连接起来，即是矢量线。

##### 6.1.2.3 栅格面的矢量化

栅格面的矢量化有三个步骤：

（1）**搜寻结点**：在栅格数据中搜寻组成面的边界弧段相接处的结点位置。结点所在的位置通常是周围的栅格单元中存在**三个及以上不同属性值**的地方。

（2）**跟踪弧段**：从结点出发，跟踪边界弧段到另一个结点结束。弧段所在的位置是周围有**两种不同栅格单元属性值**的地方。记录下两个结点之间边界弧段的矢量坐标，以及弧段两侧的面属性值。

（3）**封闭成面**：把具有相同面属性值的弧段逐个地连接起来。

### 6.2 投影变换与重投影

#### 6.2.1 投影变换

投影变换指的是将空间数据在地理坐标系的经纬度坐标与某一种选定的投影坐标系的平面直角坐标之间进行的变换。

进行投影变换的原因是：GIS使用平面直角坐标系做计算更为方便。

#### 6.2.2 重投影

重投影是把一个投影坐标系中的空间数据重新投影到另一个投影坐标系中。通过两个步骤实现：

（1）将原投影坐标逆变换为地理坐标。

（2）将地理坐标变换到目标投影坐标系。

#### 6.2.3 栅格重采样

投影可以在矢量数据或栅格数据上进行。对于栅格数据而言，新坐标系下的每一个栅格单元，它的属性值需要从原坐标系的栅格数据中对应的位置进行采集，称该过程为**重采样**。

新坐标系下，某个单元格的属性值是利用原坐标系栅格数据中**对应位置附近**的几个栅格单元的属性值进行插值计算来获得。

##### 6.2.3.1 最近邻插值法

最近邻插值法计算原理最为简单：寻找距离新栅格单元插值位置最近的一个原栅格单元的值作为插值位置的数值。它的效率最高。

##### 6.2.3.2 双线性插值法

双线性插值法采用距离新栅格单元插值位置最近的2×2个（共4个）原栅格单元进行线性插值。它的效率比最近邻插值法低，但是插值结果在整体上更为平滑。

##### 6.2.3.3 三次卷积插值法

三次卷积插值法与双线性插值法类似，它采用新栅格单元插值位置周围4×4个（共16个）原栅格单元进行加权计算。

## 第7章 空间数据——插值与估算

### 7.1 空间插值

空间插值是GIS中一种**生成新的空间数据**的技术，主要用来生成连续栅格数据，如数字高程、年降雨量等。

空间插值实际上就是通过**有限的**测量点数据，生成栅格形式的DEM或其他的在空间力连续分布现场的数据。

#### 7.1.1 空间插值原理及其分类

##### 7.1.1.1 空间插值原理

空间插值的理论依据是：地理学第一定律——**空间自相关性**。它描述的是这样一种现象：在空间里连续分布的要素，通常会有这样的性质，**邻近点的数值会有很大的相关性**。

##### 7.1.1.2 空间插值方法分类

空间插值有两类方法：

（1）**全局插值法**：使用整个区域里所有的已知测量点来计算。

（2）**局部插值法**：只使用未知点周围一定范围内的、局部的已知测量点来计算。

#### 7.1.2 空间插值方法

##### 7.1.2.1 全局插值法

全局插值法的含义是：用所有的已知测量点数值 (x, y, z) 建立一个覆盖全局的插值曲面函数 z = f(x, y)，即给整个区域建立一个**曲面函数**。然后根据未知点的坐标 (x, y) 去计算它的属性值 z。

z = f(x, y) 这个函数的最简单最常用的函数是**多项式**。因此，全局插值法通常就是**全局多项式插值法**，也就是利用所有已知的测量点来你和一个多项式函数，用这个多项式函数定义一个曲面，称其为**趋势面**。

（1）**一次趋势面插值法**：其趋势面函数是 z = a0 + a1*x + a2*y。所形成的趋势面是一个斜平面。

（2）**高次趋势面插值法**：使用更高幂次的多项式，比如二次多项式的趋势面函数是 z = a0 + a1*x + a2*y + a3*x^2 + a4*x*y + a5*y^2。所形成的趋势面是一个抛物面。，幂次越高，趋势面的形态越复杂。

全局插值法是一种**不精确**的插值方法，总会有一些测量点位于所插值出的趋势面的上方或下方，亦即，形成的趋势面**不会严格地通过所有已知的测量点**。这是运用最小二乘法的缘故。因此，全局插值法只能表达出空间分布的**整体趋势**。

##### 7.1.2.2 局部插值法

局部插值法：对于每个待插值点P，都可以选取其邻近的n个已知测量点进行插值。n个点通常在以P为圆心，以R为半径的圆内选择，这个圆称为**搜索圆**。

搜索圆有两种方法指定其半径R：（1）指定一个固定的半径R；（2）指定参与计算的测量点数，由GIS软件动态确定一个可变大小的半径R。

局部插值法主要有两类：（1）局部函数拟合法；（2）逐点加权平均法。

**局部函数拟合法**：在待插值点周围一个局部范围内拟合一个数学函数来表达曲面的形态。实际中采用**样条函数**，它所表达的曲面是精确的，能够准确地通过已知的测量点。

样条函数通常分为两部分：（1）**趋势面函数，即前述多项式函数**；（2）**基函数，用以描述局部变化特点**，它可以采用不同的函数形式，形成薄板样条、规则样条、张力样条。

用样条函数插值时，每插值一个点，都要在该点局部拟合一个样条函数，其**计算过程比较复杂**，并且其拟合出的曲面的**边界有可能产生极值**。

**逐点加权平均法**的计算公式：

![img](../../../assets/intro-of-gis-et4-note/逐点加权平均.png)

其中，Zp就是待插值点P估算出的数值，n是P周围一定范围内参与插值运算的已知测量点的个数，Zi是第i个测量点的数值，Wi是第i个测量点的**权重**。

逐点加权平均法的**关键**在于：如何计算权重Wi。有两种方法：（1）反距离加权（inverse distance weighting, IDW）；（2）克里金（Kriging）。

**反距离加权**的思想是：权重与测量点到插值点的距离成反比，离插值点越近，对插值结果的影响越大，权重也就越大。其公式如下：

![img](../../../assets/intro-of-gis-et4-note/反距离加权.png)

其中，k是幂指数，通常取值为2。

反距离加权的特点是：（1）插值出来的曲面一定是介于已知测量点数值的最大值和最小值之间的，而**不会产生极值**；（2）在已知的测试点周围形成固定的**局部极大、极小值**。

**克里金插值法**更进一步地解决权重的取值问题。其**使用复杂度高很多**，一般仅在精度要求特别高的时候，才考虑使用克里金插值法。

克里金插值法采用**半变异（半方差）函数**（semivariogram）来描述空间变异性（差异性）随距离变化的情况。常见的半变异函数有：圆函数、指数函数、高斯函数、线性函数。

克里金插值法有很多种，包括普通克里金、简单克里金和泛克里金。

### 7.2 空间密度估算

空间密度估算：计算某种空间实体在各处的分布密度，如人口密度。

有两种空间密度估算方法：（1）简单密度估算；（2）核密度（kernel density）估算，又称热力图。

它们的共同之处是：把矢量点数据上汇总的数值按照一定的范围分摊到点周围的区域中。首先，需要设定使用多大范围的区域来分摊数值。一般是设定一个半径值。

#### 7.2.1 简单密度估算

简单密度估算就是把所有观测点上的统计汇总数据**平均分摊**到其半径所确定的圆的范围内所有的栅格单元上。如果某个栅格单元落在几个点的半径范围内，则它的数值是这几个点分摊给它的数值的**总和**。

#### 7.2.2 核密度估算

核密度估算的“核”指的是**核函数**，它是定义在二维平面上的函数 z = f(x, y)，其函数值z是以一个点为圆心，沿着半径的方向向外逐渐变化的。通常**圆心处函数值最大**，**向外函数值逐渐递减**。

使用和函数计算栅格密度时，在每个观测点的位置放置一个核函数，观测点位置是核函数中心数值最高的地方，用户指定一个半径数值，用来表示核函数覆盖在半径所决定的圆形范围内。每个栅格单元的数值，都是各个核函数在该栅格单元处的函数**累加效果**。

## 第8章 空间数据——存储与管理

### 8.1 空间数据的存储与管理方式

GIS主要的空间数据存储与管理方式可分为两类：（1）文件存储与管理；（2）数据库存储与管理。

#### 8.1.1 文件存储与管理方式

GIS中两种具有代表性的文件格式：（1）Shapefile，存储矢量数据；（2）GeoTIFF，存储栅格数据；

#### 8.1.2 数据库存储与管理方式

代表性的空间数据库：（1）ArcGIS的Geodatabase；（2）OGC的GeoPackage；（3）Orace Spatial & Graph；（4）PostgreSQL支持的PostGIS。

### 8.2 空间数据的文件存储与管理

#### 8.2.1 矢量数据文件Shapefile

Shapefile由多个同名但不同扩展名的文件组成：

（1）主文件（.shp）：记录长度可变的二进制文件，每条记录都存储了一个空间要素的坐标数据。

（2）属性数据文件(.dbf)：二进制和文本混合型的文件，主文件中每条记录的空间要素所对应的属性数据，按属性表格的形式存储在这个文件里。

（3）索引文件（.shx）：记录长度固定的二进制文件，每条记录用来指明主文件里每一个空间要素坐标记录位置离主文件开头的位置偏移量。

#### 8.2.2 栅格数据文件GeoTIFF

常规的TIFF文件是一种数字图像文件格式。TIFF是 tagged image file format 的首字母缩写。数据图像文件中，以标签（即tag）存储像素颜色编码。TIFF文件存储栅格数据属性数值时，就利用了标签来表达地理空间相关的信息。

#### 8.2.3 文件存储与管理方式的弱点

（1）文件格式复杂，共享困难。

（2）文件数据完整性难以保证。

### 8.3 空间数据的数据库存储与管理

#### 8.3.1 数据库组成

（1）数据库存储系统。

（2）数据库管理系统（DBMS）。

（3）数据库应用系统。

#### 8.3.2 关系数据库的基本概念

关系数据库用关系（relation）来表达数据。其基本概念包括：

（1）表：二维数据列表。

（2）记录：表的一行。

（3）字段：表的一列。

（4）关系：一对一关系、一对多关系、多对多关系。

（5）关键字：主键和外键。

#### 8.3.3 关系表的连接

基于外键实现表的连接。

#### 8.3.4 空间数据库

大多数空间数据库都是以关系数据库的形式存储的，也就是把空间数据的属性数据表用关系数据库的关系来存储，同时把空间数据的坐标数据也存储在关系表中的一个二进制大对象（BLOB）数据类型的字段中。

##### 8.3.4.1 ESRI的地理数据库

地理数据库是ESRI公司设计实现的空间数据库，它有三种实现形式：

（1）采用微软公司Access数据库文件来存储，称为个人地理数据库。

（2）采用文件夹形式存储，称为文件地理数据库。

（3）采用数据库服务器的方式存储，称为服务器地理数据库。

##### 8.3.4.2 OGC的GeoPackage

OGC是开放地理空间联盟（Open Geospatial Consortium），GeoPackage是由OGC制定的一个开放性的、基于标准的空间数据库存储格式。它使用SQLite数据库来存储矢量数据、栅格数据和非空间的属性数据表。

##### 8.3.4.3 其他空间数据库

现在，大部分数据库系统都提供了在表中直接存储空间数据的功能。例如：SQL Server Spatial空间数据库、Oracle Spatial and Graph、PostGIS、Spatial Extender，MySQL数据库有Spatial Extension。

## 第9章 空间数据——查询与量算

### 9.1 空间数据查询

#### 9.1.1 属性查询

##### 9.1.1.1 简单的属性查询

##### 9.1.1.2 SQL属性查询

#### 9.1.2 空间关系查询

GIS空间数据库和常规数据库的最大不同点在于：常规数据库只存储常规的字符和数值形式的属性数据，而空间数据库还包含空间数据的**几何坐标位置数据**。

为了支持空间数据库的查询功能，需要**扩充谓词**，将属性约束条件和空间关系约束条件仪器结合到SQL语句中。

GIS中的空间关系查询又叫作**拓扑关系**查询。

##### 9.1.2.1 disjoint(不相交)关系查询

不相交指的是两个空间要素的边界和内部均不相交，例如，湖北省与江苏省不相交。

##### 9.1.2.2 contain(包含)关系查询

包含关系指的是一个空间要素完全包含了另一个空间要素的内部和边界，例如，山东省包含济南市。

##### 9.1.2.3 inside(内含于)关系查询

内涵与的空间关系与包含关系相对，例如，济南市内含于山东省。

##### 9.1.2.4 touch(接触)关系查询

接触空间关系指的是边界相接，例如，湖北省和湖南省接触。

### 9.2 空间几何量算

#### 9.2.1 距离量算

距离量算指计算两个空间要素之间的最短距离，也称**欧氏距离**。两个点要素(x1, y1)和(x2,y1)的欧氏距离是：

![img](../../../assets/intro-of-gis-et4-note/欧氏距离.png)

GIS通常应用距离量算，计算点要素至其他点要素、先要素或面要素之间的距离。比如，查询每个地级市距离哪条主要河流最近。

#### 9.2.2 长度量算

长度量算是计算**线要素的长度**，比如河流、道路等。加上一条先要素上有n个坐标点，其长度是：

![img](../../../assets/intro-of-gis-et4-note/线长度.png)

#### 9.2.3 面积量算

面积量算用来计算矢量面要素的面积，亦即，其边界所围合形成的多边形的面积。

GIS采用**梯形法**计算多边形的面积：按照多边形顶点顺序，一次求出多边形所有的变和x轴和y轴之间的梯形面积，然后求它们的代数和。

设一个面要素边界上具有n+1个坐标点，首个坐标点与末个坐标点相重合。其面积是：

![img](../../../assets/intro-of-gis-et4-note/面积.png)

#### 9.2.4 质心量算

质心指一个面要素多边形的**几何中心**，它可以作为在多边形中标注属性值的参考位置。质心的计算：

![img](../../../assets/intro-of-gis-et4-note/质心.png)

其中，cx是质心的x坐标，cy是质心的y坐标，S是多边形的面积。

## 第10章 空间分析——地形分析

### 10.1 空间分析概述

#### 10.1.1 空间分析的概念

空间分析是对空间实体的定量和定性研究，具体地，就是对空间数据的位置、属性这两方面进行计算，进而**产生新的空间定位数据、属性数据**，从中取得新的地理信息。

#### 10.1.2 空间分析种类

##### 10.1.2.1 按照空间数据模型分类

按照空间数据模型分类：

（1）矢量数据空间分析：输入数据是矢量数据，输出数据也是矢量数据；

（2）栅格数据空间分析：输入数据是栅格数据，输出数据也是栅格数据；

##### 10.1.2.2 按照空间分析性质分类

按照空间分析性质分类：

（1）数字地形分析；

（2）空间叠置分析；

（3）空间邻近分析；

（4）空间路径分析；

（5）空间统计分析；

### 10.2 数字地形分析

数据地形分析指的是：基于数字高程模型对**地形特征**的分析计算。它的输入是DEM，输出则是用来描述与地形某种特征相关的空间数据。

#### 10.2.1 数字高程模型的类型

##### 10.2.1.1 狭义的数字高程模型

狭义的数字高程模型是一种**矩阵形式**的高程数据，它又分为两种具体形式：

（1）**基于点位置的DEM**(point based DEM)：它所有表达的高程位置是由**矩阵形式的空间高程点**来指定的。每个高程点的x、y坐标指示其平面位置，z坐标表达高程数值。

（2）**基于栅格单元的DEM**(cell based DEM)：其每个栅格单元面积里，都存储一个高程数值，代表的是整个栅格单元所具有的**统一高度**。

##### 10.2.1.2 广义的数字高程模型

广义的数字高程模型指的是：一切用数字的形式来表达的地形高程分布数据。

（1）**栅格DEM**：它是狭义的DEM，以**栅格矩阵形式**存储高程数据。二维显示栅格DEM使用不同的颜色或不同的灰度来显示不同的高程，三维显示栅格DEM可以使用透视场景图的方式展示地形起伏。优点是**数据结构简单**，缺点是**分辨率较高时数据量非常大**。

（2）**不规则三角网**（TNT）：以不规则的、彼此相连的三角形，形成网状结构，覆盖整个地形表面，近似地表示地面。每个三角形的顶点都是具有高程数值的点。不规则三角网的生成基于**德劳内三角化**算法，其原理是：连接离散点形成的三角形，其**外接圆**的内部不能包含点数据集种的任何点。

（3）**等高线**：等高线上的高程处处相等，它是连接相同高程值的点形成的曲线，并按照**等高距**顺序排列。等高距是相邻两条等高线的高程差距。等高线是**矢量线要素数据**。等高线需要结合**地形特征点**、**地形特征线**来精确表达地形，如山峰、山脊线、谷底线。

#### 10.2.2 数字高程模型类型的转换

数字高程模型类型的相互转换在栅格DEM、不规则三角网、等高线三者之间进行。

##### 10.2.2.1 栅格DEM转换生成等高线

使用相邻栅格单元之间的**线性插值法**来计算出等高线上的点所在的位置，再把这些点连接起来，形成等高线。

##### 10.2.2.2 TIN转换生成等高线

与栅格DEM转成等高线类似，对**三角形边**上的高程点实施线性插值法。

##### 10.2.2.3 等高线转换生成栅格DEM

使用**相邻等高线**间的线性插值法，插值计算每一个栅格单元中心点所在位置的高程值，作为栅格单元的属性值。

##### 10.2.2.4 TIN转换生成栅格DEM

将不规则三角形看成一个**空间斜平面**，根据栅格单元中心点的坐标，插值出在斜平面上的高程。

##### 10.2.2.5 等高线转换生成TIN

将**相邻等高线**的坐标点连接起来，生成不规则三角形。

##### 10.2.2.6 栅格DEM转换生成TIN

不需要把所有的栅格单元都作为三角形的顶点，只把一些**重要的栅格单元**保流下来作为顶点，再运用德劳内三角化算法生成TIN。

重要栅格单元的选取采用**最大z容差算法**：

（1）开始时再栅格DEM里选四个角落里的栅格单元中心点，将其作为TIN的顶点，运用德劳内三角化运算生成TIN；

（2）初步生成的TIN没有选择栅格DEM中的所有单元，这是判断TIN与原来栅格DEM在高程上的差值；

（3）如果所有的栅格单元与TIN的高程差都在最大z容差之内，则TIN生成完毕；

（4）如果某些栅格单元与TIN的高程差超出了最大z容差，则将高程差最大的那些栅格单元保留下来，作为新的TIN顶点，再回到（1），如此迭代下去，直至（3）满足。

#### 10.2.3 坡度与坡向

**坡度**（slope）描述的是地面上某一位置的**高程的最大变化率**。**坡向**（aspect）则是坡度变化的方向。

坡度和坡向分析通常采用**栅格DEM**作为输入数据。而输出数据则是**栅格坡度数据**，每个栅格单元存放其坡度数值。

坡度分析就是计算栅格DEM的每个栅格单元与其**周围栅格单元之间**的最大的高程变化率。

计算坡度的基本思想：坡度取决于栅格单元的高程再水平x方向和y方向上的变化率。栅格单元的**坡度**是：

![img](../../../assets/intro-of-gis-et4-note/坡度.png)

该公式计算出的坡度是弧度（radian）单位。公式的**导数计算**则通常再局部的3×3共9个单元格的数值来模拟计算。

![img](../../../assets/intro-of-gis-et4-note/坡度公式导数.png)

其中，z1到z9是栅格单元的高程，sx和sy是栅格单元在x和y方面上的大小。

**坡向**的计算公式：

![img](../../../assets/intro-of-gis-et4-note/坡向.png)

坡向使用**方位角**的角度来表达。方位角以正北为起算角度，按顺时针方向递增。

#### 10.2.4 山体阴影

**山体阴影**（hill shade）又称为晕渲，按照**光照条件**来计算栅格DEM中每一个栅格单元的明暗程度。

模拟一个平行光源（光源位于无穷远处），让光照射到栅格DEM的表面上，从而在地形表面形成不同的明暗效果。朝向光源的地方明亮，背向光源的地方昏暗。

山体阴影的计算取决于两个条件：（1）内部条件是每个**栅格单元自身的坡度、坡向**；（2）外部条件是**光源（如太阳）在空间中的位置**。

山体阴影计算得到一个栅格数据，每个栅格单元里的属性是一个介于0~255的整数，0最暗，255最亮。

### 10.3 视域分析

视域分析就是计算人站在地形上的某一个位置**所能看到的视野的范围**。

#### 10.3.1 视域分析的原理

人站在地形上的位置，称为**视点**。整个DEM上的每个点（称为**目标点**）对于视点而言，有两种情况：

（1）可见：视点位置与目标点位置之间没有更高的地形来阻隔。

（2）不可见：视点位置与目标点位置之间有更高的地形来阻隔。

视域分析就是从视点进行观察，判断在整个地形上**哪些地方可见，哪些地方不可见**。对于每个目标点而言，视域分析的输出结果是一个**二值数据**。视域分析的输入可以是栅格DEM或TIN。

视域分析的**计算量通常很大**，因为需要将DEM中所有的点与视点连成**视线**，判断是否有阻挡。而如果有多个视点，则又可能出现**视域范围互有重叠**的情况。

视域分析也可以把**线要素作为视点**，比如，模拟观察沿着公路行走所能看到的范围。

视域分析通常可以设置一个视点的**高度偏移数值**，表明视点是高出地面一定高度的某个人眼睛的位置，或在建筑物上。

#### 10.3.2 视域分析的应用

4G/5G通信基站选址是视域分析的一个典型应用。

### 10.4 流域分析

流域分析（watershed analysis），又称水文分析（hydrologic analysis）。

流域指的是，有共同出水口的积水区域。流域范围的边界通常就是地形上的分水岭。

流域分析就是要通过对地形的分析，找出地形上河流的位置，以及各个河流的流域范围。

流域分析**输入一个栅格DEM**，分析的结果有两个：

（1）**河流栅格数据**，将地形上可能存在河流的栅格单元计算出来。

（2）**流域范围数据**，将河流上游地面的水流能流入该河流的区域计算出来。

#### 10.4.1 无洼地栅格DEM

流域分析要计算每个栅格单元的降水最终会向哪个地方流动，因此就要求每个栅格单元上的水都要有一个明确的方向，亦即，每个栅格单元上的水都要能流出去。但是栅格DEM中存在**局部洼地**的栅格单元。

局部洼地的栅格单元，其**高程数值比周围其他栅格单元都要低**。

去除洼地栅格单元，采用**填充洼地栅格单元**的方法，将局部洼地的栅格单元的高程数值调整为其**周边8个栅格单元中高程数值最低**的那一个单元的高程数值。

#### 10.4.2 流向栅格

流域分析规定，水流**只能流向**周围8个相邻栅格单元中的某一个，也就是**下坡坡度最陡**的那个栅格单元。

具体地，通过分别计算栅格单元与周围8个相邻栅格单元的**坡降**来做出判断。

为了记录流向，在流向栅格中每个栅格单元赋予一个**表示流向的属性数值**。因为共有**8个可能的流向**，流向属性的数值通常有8个。

#### 10.4.3 流量累积栅格和河流栅格

利用流向栅格的数据，进一步生成流量累积栅格数据。

流量累积栅格数据中的每一个栅格单元的属性值，代表的是所有其在上游的栅格单元的**累积数量**。

所谓某个栅格单元的**上游栅格单元**，指的是如果按照计算出来的流向栅格数据，某一个栅格单元的水**最终逐渐会流入**该栅格单元，那么，那个栅格单元就是该栅格单元的上游。

在生成的流量累积栅格数据中，**流量累积数值为0**的栅格单元可能就是**地形分水岭**的位置，而**流量累积数值较大**的栅格单元可能就是**河流**所在的位置。

具体地，通过设置一个流量累积**阈值**来决定，阈值是一个**相对较大**的流量累积数值。如果栅格单元的流量累积数值**大于等于**该阈值，就认为该栅格单元位置是河流，反之则不是。

#### 10.4.4 河流链路栅格

河流的**分段**，就是把每一条**支流**都当作一个独立的河段，而在干流上，把**两条相继汇入的支流中间的干流**作为一个河段。

河流链路栅格数据将整条河流分成一段一段连接的水系，并给每一个河段分配一个**唯一代码**。

生成河流链路栅格数据的方法是：

（1）从某个河流支流的源头开始，**从上游往下逐个搜寻河**流栅格单元，并**赋予唯一代码**。

（2）当搜寻到有其他河段的河流栅格单元时，完成这一河段的搜寻，再从其他河流支流开始新的搜寻。

（3）完成支流搜寻后，再搜寻干流的河段。

#### 10.4.5 流域栅格

结合河流链路栅格数据、流向栅格数据，可以对其中每个河段计算出流入这个河段的**所有上游栅格单元**，也就是该河段的**流域范围**。

流域栅格单元的属性值是其**流入河段的唯一代码**。

GIS还可以生成对于某个感兴趣点的流域范围，即**泻流点**的流域范围，例如，再河流上建设一个水库的拦河坝。

## 第11章 空间分析——叠置分析

空间叠置分析就是在统一的坐标系下，对处于相同区域的多个不同性质的空间数据进行**集合运算**，从而**产生新的**空间数据的分析过程。

### 11.1 栅格叠置分析

栅格叠置分析的输入和输出数据都是栅格数据。

进行栅格叠置分析的**前提条件**是：多个相同地区的栅格数据之间，必须具有**相同大小的空间范围**，**栅格单元的大小也必须相同**。

如果叠置分析的两个栅格数据存在大小不一致，需要进行**重采样**。

#### 11.1.1 地图代数

栅格叠置以**地图代数**的形式进行，一个地图代数式包含两部分内容：

（1）操作数：输入的栅格数据；

（2）运算符：栅格数据之间要进行的计算；

其中，运算符分为以下几类：

（1）算数运算符：+，-，*，/

（2）逻辑运算符：NOT，AND，OR，XOR

（3）关系运算符：=，!=，>，<，>=，<=

（4）函数运算符：^，sqrt，sin，cos，tan，asin，acos，atan，log10，ln，abs，max，min

两个例子：

（1）用4月温度栅格数据、5月温度栅格数据计算两个月的平均温度：将两个数据相加再除以2；

（2）夏季避暑山庄寻址：

* 第一个条件：高程处于800m至1000m之间；
* 第二个条件：坡度小于15度；
* 第三个条件：坡向再东南、南、西南向之间；

#### 11.1.2 栅格联合

栅格联合是对栅格数据之间所有栅格属性值进行**空间组合**，对每一种组合都赋予一个新类型的属性值。

比如一个是土壤类型栅格数据，另一个是植被类型栅格数据。前者的土壤类型是A、B两种，后者的植被类型有甲、乙两种。则空间组合包括：

（1）土壤类型A / 植被类型甲；

（2）土壤类型A / 植被类型乙；

（3）土壤类型B / 植被类型甲；

（4）土壤类型B / 植被类型乙；

### 11.2 矢量叠置分析

栅格叠置分析的输入和输出数据都是矢量数据。

#### 11.2.1 矢量叠置分类

##### 11.2.1.1 按叠置数据层的数量分类

根据有多少个矢量数据层参与叠置分析，可以分为两类：

（1）**两个**矢量数据层的叠置：**区分**两个数据层，前者称为**输入数据**，后者称为**叠置数据**；

（2）**三个及以上**矢量数据层的叠置：**不区分**数据层，统称为输入数据；

##### 11.2.1.2 按输出属性数据的来源分类

根据输出结果中属性数据的来源，可以分为两类：

（1）结果**包含所有层**属性字段；例如，一个输入数据是土壤分布数据，一个数据是坡向分类数据；前者包括黄壤、棕壤两类值，后者包括南坡、北坡两类值；则输出结果是两个数据的联合：黄壤 / 南坡，黄壤 / 北坡，棕壤 / 南坡，棕壤 / 北坡；

（2）结果**仅包含输入层**属性字段；例如，数据数据是土壤分布数据，叠置数据是校园范围；前者包含黄壤、棕壤两类值；则输出结果只包含土壤类型，但校园范围以外的数据不被保留；

##### 11.2.1.3 按空间要素类型分类

根据空间要素的类型进行分类：（1）点-点叠置；（2）点-线叠置；（3）点-面叠置；（4）线-面叠置；（5）面-面叠置；（6）点-线-面混合叠置；

所谓点-点叠置，指的是就是参与叠置分析的两个矢量数据都是点要素数据，其他形式以此类推；

##### 11.2.1.4 按逻辑运算类型分类

根据运算类型进行分类：（1）裁剪；（2）交集；（3）联合；（4）对称差；（5）擦除；（6）识别；（7）更新。

#### 11.2.2 裁剪

裁剪（clip），又称为提取（extract），**只能在两个**矢量数据层之间进行，用**叠置数据去裁剪输入数据**。

裁剪支持所有空间要素类型，要求是叠置数据的集合维度要大于、等于输入数据。其中，点是零维、线是一维、面是二维。

例如，将全国地级市的点要素数据作为输入数据，将浙江省行政区面要素数据作为叠置层，裁剪的结果是：浙江省地级市的点要素数据。

#### 11.2.3 交集

交集（intersect）用来计算并输出多个矢量数据层之间在**空间上相交**的部分，**可以在多个**矢量数据层之间进行。

交集支持所有空间要素类型，其结果只保留参与计算的矢量数据层中**空间维度最小的**数据。其结果的属性数据**包含了所有输入数据的**属性字段和数值。

例如，一个输入数据是是土壤分布数据（包括黄壤、棕壤两类值），另一个输入数据是校园范围；其交集是：黄壤校园、棕壤校园。

#### 11.2.4 联合

联合（union）**只能针对面要素**数据进行。**可以在多个**面要素数据层之间进行。

联合运算输出的结果**包含了所有**输入数据的属性字段和数值。

例如，一个输入数据是水污染区域，一个输入数据是大气污染区域。其联合是：只有水污染的区域，只有大气污染的区域，水和大气都污染的区域。

#### 11.2.5 对称差

对称差（symmetrical difference）与交集运算时相反的。它的结果数据中保留的是各个输入数据中**空间上不相交**的部分，而空间上相交的部分则被去掉。

对称差运算往往要求所有的输入数据都是**相同维度**的矢量空间数据。

对称差运算的输出结果**包含了所有**输入数据的属性字段和相应的属性值。

例如，一个输入数据是水污染区域，一个输入数据是大气污染区域。其对称差是：只有水污染的区域，只有大气污染的区域。

#### 11.2.6 擦除

擦除（erase），又称为差异（difference）。其作用是用叠置数据把输入数据中与叠置数据**重叠的部分去掉**。

擦除运算要求叠置数据的几何维度大于、等于输入数据的几何维度。

例如：输入数据是是土壤分布数据（包括黄壤、棕壤两类值），叠置数据是校园范围；擦除运算的结果是：校园范围以外的黄壤区域、棕壤区域。

#### 11.2.7 识别

识别（identity）是用叠置数据对输入数据进行空间和属性的**加注**，即把叠置数据的空间要素和输入数据进行叠放，并使空间重叠的部分既包含输入数据的属性，也包含叠置数据的属性。

例如，输入数据是土壤类型（包括黄壤、棕壤两类值），叠置数据是林地范围；前者识别运算的结果是：林地以外的部分——黄壤、棕壤，林地以内的部分——黄壤/林地、棕壤/林地。

#### 11.2.8 更新

更新（update）是将输入数据中与叠置数据**重叠部分**的面要素**替换**成叠置数据的面要素及其属性。

更新运算的输入和叠置数据均**只能是面要素**数据。并且，叠置数据的属性字段必须与输入数据相一致。

例如，输入数据是土壤类型数据（黄壤、棕壤），叠置数据是土壤类型数据（水稻土壤）；更新运算的结果是：输入数据中与叠置数据相重叠的部分被替换为水稻土壤。

#### 11.2.9 空间连接

空间连接（spatial join）与矢量数据叠置分析相似。进行空间连接，需要设置四个条件：

（1）**基础数据层**：属性数据被连接到的矢量数据层；例如，村庄分布的点要素矢量数据（杏花村、稻香村）；

（2）**连接数据层**：提供连接属性数据的矢量数据层；例如，土壤分布类型的面要素数据（黄壤、棕壤）；

（3）**空间连接关系**：指出基础数据层中每个空间要素依据什么空间关系与连接数据层中的空间要素进行连接；例如，空间关系“内含于”指出，如果基础数据层中某个点在空间上被包含于连接数据层中的某个多边形范围内，则该点和多边形的属性就要进行连接；

（4）**连接类型**：包括一对一、一对多两种类型；一对一指的是，点仅仅和符合空间关系（"内含于"）的第一个多边形连接；一对多指的是，点和所有符合空间关系（"内含于"）的多边形连接；

上述例子所进行空间接连的结果是：村庄分布的点要素矢量数据中，每个点要素被连接上其“内含于”的土壤分布类型的面要素数据的土壤数据；比如：杏花村/黄壤，稻香村/棕壤。

## 第12章 空间分析——邻近分析

邻近指的是，某个地理现象或某个空间实体在它周围一定距离内产生的影响范围。

空间邻近分析就是**生成空间实体周围的影响范围**。

几个空间邻近分析的实际例子：

（1）地震破坏程度扩散影响范围的问题；

（2）道路交通噪声污染影响范围的问题；

（3）湖泊生态保护区范围的问题；

（4）小学学区范围划分的问题；

### 12.1 矢量空间邻近分析

矢量空间邻近分析以矢量数据作为输入，分析的结果也是矢量数据。

#### 12.1.1 空间缓冲区分析

空间缓冲区指的是一个**空间区域或范围**，该区域**围绕**着某个空间要素按照**一定距离**产生。

空间缓存区分析就是要**生成空间缓冲区**，其过程是：

（1）基于一个空间要素，点、线或面。

（2）设定一个距离，离开所基于的空间要素，扩展到这个距离后，就**形成一个环绕的面要素**，此即缓冲区。

##### 12.1.1.1 基于点要素的缓冲区

基于点要素的缓冲区在空间上的形状，就是一个以点为圆心，以缓冲距离为半径的圆。

例如，点要素数据是广东省主要城市，设定每个城市有50km的经济辐射范围，就可以通过生成缓冲区得到广东省主要城市的经济辐射范围矢量数据。当两个城市距离较近，50km半径生成的缓冲区可能重叠在一起，这时可以选择是否进行**融合**。

##### 12.1.1.2 基于线要素的缓冲区

基于线要素的缓冲区是围绕着线要素的条带状多边形，其生成办法是：先在线要素的两侧离开缓冲距离的位置生成平行线，然后在接头处进行**连接处理**，最后在线的两个端点位置进行**封闭处理**。

连接处理有三种样式：（1）圆角连接；（2）平台连接；（3）尖角连接；

封闭处理有三种样式：(1)圆头封闭；（2）平头封闭；（3）方头封闭；

除了对重叠部分选择是否融合外，线要素缓冲区还有一种变化形式可以选择：**单侧**缓冲区或**双侧**缓冲区。

基于线要素的缓冲区的实例：河流缓冲区。

##### 12.1.1.3 基于面要素的缓冲区

基于面要素的缓冲区形状是围绕面要素形成的面状多边形。

面要素生成缓冲区有几种不同形式：（1）**外侧**缓冲区；（2）**内测**缓冲区；（3）**全覆盖**缓冲区。

在GIS软件生成缓冲区时，对于缓冲距离的设置有两种方式：（1）设定一个所有空间要素**都要采用的相同的**距离数值；（2）指定属性数据中某个特定的字段，各个空间要素采用**各自在这个属性字段中存储的数值**作为缓冲距离，生成**各自距离不等**的缓冲区；

缓冲区距离有两种可以选择的计算方法：（1）**欧式**（Euclidean）距离；（2）**测地线**（geodesic）距离；欧氏距离即是平面距离，在一个较小的局部地区生成缓冲区时，可以采用它；当缓冲区扩展到一个范围很大的区域，就要考虑**地球曲率**的影响了，此时就不能用欧氏距离，而应当采用测地线距离。测地线距离是球面上两点间的最短距离，通常是连接两点形成的**大圆上弧的长度**。

缓冲区分析还可以生成**多环缓冲区**，即围绕空间要素周围按照相等的距离间隔，生成一系列**层层嵌套**的缓冲区。例如，围绕湖泊周围建立多环缓冲区，第一环距离是0~5km，第二环距离是5~10km，第三环距离是10~15km。

#### 12.1.2 泰森多边形分析

泰森多边形（Thiessen polygon），在GIS中又称Voronoi多边形。它是由平面空间中一些离散分布的点扩展生成的区域。

泰森多边形表达的几何意义是：**距离离散点最近的邻近空间范围**，即在某个泰森多边形内，任意位置到生成该多边形的点要素的距离，都要小于这一位置到其他点要素的距离。

泰森多边形的集合形式的数学定义：

![img](../../../assets/intro-of-gis-et4-note/泰森多边形集合形式的数学定义.png)

其中，p1,...,pn是二维平面空间中的有限n个离散点要素，点p是任意位置点，V(pi)是第i个离散点要素生成的泰森多边形，d(p,pi)是点p到离散点pi的距离，d(p,pj)是点p到离散点pj的距离。

根据数学定义，泰森多边形**边界上的点**到相邻两个离散点的**距离相等**。

泰森多边形的生成**借助于不规则三角网**(TIN)，其生成过程是：

（1）利用德劳内三角化算法，基于离散点数据生成不规则三角网；

（2）泰森多边形的每一条边都一一对应着不规则三角网中三角形一条边的**垂直平分线**，基于此，确定泰森多边形的各条边；

### 12.2 栅格空间邻近分析

栅格空间邻近分析输入输出的都是栅格数据。

#### 12.2.1 栅格自然距离计算

栅格自然距离（physical distance），又称栅格欧氏距离（Euclidean distance），可将其理解为平面上的直线距离。

栅格自然距离计算所做的就是：计算栅格数据中每个栅格单元到**离它最近**的**源栅格单元**的**直线距离**。

##### 12.2.1.1 栅格自然距离计算原理

在进行栅格自然距离计算时，源栅格单元的属性值**不是“无数据值”**，而其他栅格单元的属性值均是“无数据值” 。

源栅格单元**对应着**矢量数据中的点要素、线要素、面要素。

栅格自然距离计算的具体方式：

（1）计算所有栅格单元到**离它最近的源栅格单元的直线距离**，将计算出的距离数值作为栅格单元的属性值，以生成新的栅格数据；

（2）假定栅格单元的长、宽都是1，则源栅格单元的上、下、左、右位置的四个栅格单元到源栅格单元的距离是1，而源栅格单元左上、右上、右下、左下四个栅格单元到源栅格单元的距离是根号2，约1.4。

（3）如果有多个源栅格单元，**以距离最近的那个为准**；

##### 12.2.1.2 栅格数据重分类

栅格数据重分类指的是：使用一张新旧数据对照表，对原有栅格数据中的属性值**重新进行分类赋值**，从而得到一组新类型值所表达的**新栅格数据**。

例如，可以将土壤类型分类的栅格数据中的值为2的红壤、值为7的黄壤、值为8的砖红壤，都归为新的值为9的红壤，然后元栅格数据中属性值为2、7、8的栅格单元被赋予属性值9。

对栅格自然距离计算生成的结果进行重分类，比如将距离从0.0到2.0的栅格单元**赋予新的数值1**，把距离大于2.0的栅格单元**赋予“无数据值”**，这样生成的结果数据，与矢量数据生成的缓冲区非常相似。

#### 12.2.2 栅格自然距离分配

栅格自然距离分配是栅格自然距离计算的一个**副产品**。

在进行栅格自然距离计算的过程中，对于每个栅格单元，在获知其**距离哪个源栅格单元最近**时，将其作为属性值保存起来。

如果以点要素位置为源栅格单元，由此计算出的栅格自然距离分配数据，直接对应着基于这些点要素生成的**矢量泰森多边形**的结果。

## 第13章 空间分析——路径分析

### 13.1 矢量路径分析——网络分析

GIS中的网络分析主要用来解决一些和网络有关的计算。现实世界中的网络包括：道路网络、河流网络、通信光纤网络等。

#### 13.1.1 网络数据结构

网络数据结构是表达和存储网络数据的数据结构。

##### 13.1.1.1 复合的矢量数据

网络数据结构是一种复合的矢量数据结构，它是多层数据的集成，既有**表达交叉点的点要素**，也有**表达路线的线要素**。

网络数据是一种点和线两种空间要素结合起来的复合矢量数据结构。

##### 13.1.1.2 网络拓扑数据

网络数据结构还需要表达**网络拓扑数据**，它使用**图论**（Graph theory）中的一些概念来表达**网络的连接关系**。

以道路网络为例，用**结点**（node）来表示道路的交叉点，用**边**（edge）来表示两个结点之间的道路。

一个**图**（graph）由**结点的集合**和**边的集合**组成。

**无向图**：结点之间连接成的**边没有特定方向**。在道路网络中，其表达的是一条可以双向同行的道路。

**有向图**：结点之间连接成的**边有特定方向**。在道路网络中，它可以表达单行道，也可以表达双行道。有方向的边，又称为**弧**。

**网络**指的是：边或弧上带有权重数值的图。在道路网络中，边或者弧上的权重又称为**链路阻抗**，用以表达路段长度、预计通行时间等。

网络数据的存储：在空间数据和属性数据的基础上，采用**邻接表**来表达网络拓扑结构。邻接表就是用来表达网络中在每个结点处与结点直接通过边相连的另一个结点的信息的表格。

| 结点ID | 邻接结点ID、弧ID |
| ---| ------ |
| ①  | ①,1 | ④,3 | ⑤,7 |
| ②  | ①,1 | ③,2 |     |
| ③  | ②,2 | ④,4 | ⑤,5 |
| ④  | ③,4 | ⑤,6 |     |
| ⑤  | ④,6 | ①,7 |     |

在实际的道路网络中，还要考虑更为复杂的情况：

（1）道路交叉口的结点，有交通信号灯控制通行，这会增加结点处的等待时间；

（2）交通信号灯可能控制着直行、左转、右转等不同方向，并且不同方向的等待时间可能是不同的；

（3）道路交叉的结点可能存在交通限制的情况，比如禁止左转、禁止右转等；

基于**转弯表**来表达道路交叉口结点的转弯情况，以**转弯阻抗**来记录等待时间；对于禁止转向的道路，设定其转弯阻抗为无穷大值。

| 结点ID | 起始边ID | 转向边ID | 转弯阻抗 |
| ------ | ------ | ------ | ------ |
| ⑨  | 1 | 2 | 20 |
| ⑨  | 1 | 3 | 30 |
| ⑨  | 1 | 4 | ∞ |
| ⑨  | 1 | 1 | ∞ |
| ...  | ... | ... | ... |

#### 13.1.2 最短路径算法

最短路径算法中最常用的一种是**迪杰斯特拉**算法。

迪杰斯特拉算法能够在网络中求出一个结点出发到其他结点的最短路径。其基本思想是：

（1）假设以出发的结点为起点，最终要到达的结点为终点；**依据路径长度递增的顺序，逐步寻找从起点到其他结点的最短路径**；

（2）一旦寻找到所需要的终点，就结束算法，或者，如果网络中的重点和起点之间没有路径相同，无法找到最短路径，也就结束算法；

#### 13.1.3 网络分析应用

##### 13.1.3.1 最佳路径计算

最佳路径计算就是指：在道路网络上设定好起点位置和终点位置，要求GIS计算出一条连接这两点的最佳路径。

最佳路径的结果是网络中按通行顺序形成的一个**边的集合**。

所谓的最佳，可以指距离最短，也可以指所用时间最少。

对于任意多个起点到任意多个终点之间的最佳路径计算，通常不再注意每一对起点和终点之间的实际路径在网络中是怎么走的，而仅仅关注路径的最短长度或最少时间的数值。这种计算被称为**OD成本矩阵分析**。

##### 13.1.3.2 最近设施计算

最近设施计算指的是：针对一些事件所发生的地点，沿着周围的道路区寻找附近的相应设施点，这些设施点到事件点需要满足具有最短距离或最少通行事件等要求。

例如，交通事故和最近的医院、火灾和最近的消防站等。

最近设施计算可以得出从距离事件位置最近的设施到事件位置的最佳路径。

##### 13.1.3.3 网络服务范围计算

在进行网络服务范围计算时，首先要给定一些设施点的位置。例如，道路网络中一家超市的位置。

网络服务范围计算可以用来分析这家超市的服务范围有多大。

假设从这家超市出发，沿周围道路行走距离在1km以内的居民都有可能到这家超市区购物，那么这个沿着道路行走1km所能达到的最远点就可以形成这家超市的服务范围。

网络服务范围计算与空间缓冲区分析的区别在于：空间缓冲区分析是直线扩展，其结果是一个规则的圆形；而网络服务范围计算则是沿着道路去计算最短距离，其结果通常是一个不规则的多边形。

### 13.2 栅格路径分析——成本路径分析

矢量路径的网络分析基于既有的道路网，而栅格的**成本路径分析**则应用于道路网还不存在的情况下，在起点和终点之间生成一条**成本**最小的路径。

这个成本可能指的是：在起点和终点之间新建一条道路的工程费用；而成本最小的路径就是设计一条路径，使得工程建设费用最低。

成本路径分析所生成的路径是**一系列的栅格单元**。

成本路径分析的输入数据包括：

（1）**源栅格数据**：以源栅格单元表示成本路径的起点，源栅格单元的位置用具体的属性数据来表示，而其他栅格单元的属性值则是“无数据值”；

（2）**成本栅格数**：每个栅格单元的属性值表示了要在空间上经过这个栅格单元所要消耗的成本数值；

（3）**目的地栅格数据**：指定目的地位置的栅格数据，表达路径最终要达到的终点；

成本路径分析计算的是从源栅格单元到目的地栅格单元经过的**最小累积成本**路径，就是将所有经过的栅格单元的成本相加起来得到的成本总和最小的路径。

#### 13.2.1 成本距离计算

成本距离计算使用源栅格数据和成本栅格数据作为输入，生成的结果是**成本距离栅格数据**。

成本距离栅格数据中，每个栅格单元中的数值所表达的是：这个栅格单元到离它最近的源栅格单元的**最小累积成本值**。

成本距离计算从源栅格单元开始向外逐渐扩展，类似于栅格空间邻近分析中的自然距离计算方法：

（1）设定源栅格单元的最小累积成本距离是0；

（2）计算源栅格单元周围相邻栅格单元到源栅格单元的成本，具体地，从一个栅格单元到相邻的另一个栅格单元的成本距离是两个栅格单元中心点之间的成本，亦即，在每个栅格单元中**分别经过一半距离**，产生两个一半成本之和，如果是对角线方向，则要乘以根号2；

（3）对于已经计算过的相邻栅格单元，重复（2）的过程，分别对（2）中计算过最小累积成本距离的栅格单元再计算其相邻栅格单元的最小累积成本距离；

迭代上述过程，直至所有的相邻栅格单元都被计算出最小累积成本值。

#### 13.2.2 成本距离分配

成本距离分配是指：再计算某个栅格单元的最小累积成本时，判断该栅格单元是**到哪一个源栅格单元的累积成本最小**，离哪个源栅格单元近，即赋予该栅格单元那个源栅格单元的属性值。

成本距离分配的计算是成本距离计算的**副产品**，其输出是：成本距离分配的栅格数据。

在具有**多个源**的时候，成本距离分配可以起到对整个空间根据成本距离的远近进行**划分**的作用。

它与自然距离分配的区别在于：自然距离分配相当于矢量数据的泰森多边形，考虑的是直线距离，而成本距离分配则考虑的是成本距离；

#### 13.2.3 成本回溯链接

成本回溯链接就是指：在计算各个栅格单元最小累积成本的时候，记录下该栅格单元是从前面哪一个栅格单元累积过来的，即该栅格单元在成本距离路径上的**前驱**栅格单元。

成本回溯链接同样是成本距离计算的**副产品**。其输出是：成本回溯栅格数据。

通常一个栅格单元会有8个相邻栅格单元，其中某一个就可能是它到达源栅格单元的前驱，因此，可以采用8**个方向代码**来表达一个栅格单元的前驱。

#### 13.2.4 成本路径计算

成本路径计算需要给定一个**目的地栅格数据**，以指示路径的目的地。然后，结合成本距离栅格、成本回溯栅格数据，生成目的地栅格单元到其最近的源的**最小成本路径栅格数据**。

## 第14章 空间分析——统计分析

空间统计分析指的是使用统计学的方法对空间数据进行计算，以获得空间实体在统计学上的一些特征。

### 14.1 属性数据统计

属性数据统计就是对GIS数据中属性表的某些字段所包含的全部或部分数值进行统计计算，获得统计结果。

#### 14.1.1 属性数据分类

属性数据是存储在属性表中的记录和字段内的数据。

属性数据的分类方案有两种：

（1）按照数据类型进行分类，包括字符型、数值型、日期型、逻辑型、二进制型；

（2）按照测量尺寸进行分类：包括定名数据、定序数据、定序数据、定比数据；

##### 14.1.1.1 定名数据

定名数据描述空间实体的不同种类或不同名称，例如，土壤类型、植被类型、城市名称等。

##### 14.1.1.2 定序数据

定序数据用来表达分级的概念，即空间实体某种性质的级别或层次。例如，中国的城市可以分为一线城市、二线城市等。

##### 14.1.1.3 定距数据

定距数据指的是一种可以进行加减法运算却不能进行乘除运算的数值类型，即数值之间的间距可以通过加减运算求得，但数值之间不存在比例关系。例如，摄氏温度。

##### 14.1.1.4 定比数据

定比数据是在定居数据的基础上更进一步，可以进行加减乘除等运算的数值类型，数值之间存在比例关系。例如，人口密度数据。

#### 14.1.2 描述性统计量

描述统计量包括：

（1）样本数：参与统计的样本的总数量；可以运用在定名、定序、定距、定比数据上；

（2）总和：参与统计的所有空间要素在统计字段上的所有数值的累加之和；只能运用在定距和定比数据上；

（3）均值：总和除以样本数所得到的数值，即算数平均数；只能运用在定距和定比数据上；

（4）最大值、最小值、极差：极差是指最大值减去最小值得到的差值；只能运用在定距和定比数据上；

（5）中位数、第一四分位数、第三四分位数、四分位距：中位数是处在所有样本数据中间位置的那个数；第一四分位数是正好排在前四分之一的那个数，第三四分位数是指正好排在后四分之一的那个数；四分位距是第三四分位数减去第一四分位数的结果；

（6）方差、标准差：方差是所有数值离开均值分布的范围；标准差是方差的平方根；

（7）众数和种类数：众数是所有样本中数值出现次数最多的那个数；种类数是所有样本中数值不同的样本的个数；

#### 14.1.3 统计图

常用的统计图包括：

（1）直方图：表达某一种数据在不同数值区间中样本的分布数量或分布频率；

（2）柱状图：并排地列举各个统计样本的实际数值；

（3）饼图：表现各个统计样本的数值在总量中所占的比例；

（4）箱型图：表现描述性统计量之间的数值分布状态，包括中位数、第一四分位数、第三四分位数、最大值、最小值、均值；

（5）散点图：比较两个不同变量数值之间的对应关系；

### 14.2 栅格数据统计

栅格数据统计输入若干个栅格数据，对栅格单元属性值进行统计计算，获得统计特征，再以一个新的栅格数据的属性值形式输出。

#### 14.2.1 局域统计

栅格数据的局域统计指的是：对若干个同一地区，但不同数值的栅格数据进行对应栅格单元的统计计算。

所谓对应栅格单元，指的是不同栅格数据中在**空间位置上重合**的栅格单元。

局域统计就是对所有在空间位置上重合的栅格单元的数值进行的**统计计算**，计算的结果保存在输出的新栅格数据中相应空间位置的栅格单元内。

通常进行栅格统计计算的所有输入栅格数据在空间范围和栅格大小方面都要求是完全相同的。如果不完全不相同，则需要进行预处理，使其完全相同。

例如，输入四个栅格数据，分别是某地区一年中四个季度的平均温度分布。利用局域统计可以计算出：各栅格单元的最小值、均值、众数等。

#### 14.2.2 邻域统计

栅格数据的邻域统计，又称焦点统计，它通常只有一个输入的栅格数据，此外还要指定一个邻域范围。

邻域范围一般是以一个被称为**焦点**的栅格单元为**中心**，在这个焦点周围的以**给定的长宽或者半径**来定义一片区域。邻域并不包含焦点栅格单元自身。

邻域统计就是把输入栅格数据中每一个栅格单元**分别作为焦点**，统计它周围邻域中所有栅格单元的属性值的统计量，把计算结果存储到焦点对应的栅格单元位置，形成输出的栅格数据。

常见的邻域设置方法有四种：矩阵邻域、圆形邻域、扇形邻域和环形邻域。

#### 14.2.3 分区统计

栅格数据的分区统计指的是：对一个输入栅格数据，按照某种空间分区进行统计。

例如，有一个大范围的年降水量栅格数据作为输入量，若在这个范围内有若干个行政分区，则可以分别统计出各个行政区内的年降水总量或年平均降水量等。

#### 14.2.4 全局统计

栅格全局统计是对整个栅格数据所有栅格单元的属性值进行的统计，并输出常用描述性统计量的统计结果数值。

例如，可以对某个地区的栅格DEM数据做一个全局统计，计算出最大高程、最小高程、平均高程等。

全局统计并不输出栅格形式的数据，而只是输出简单的统计数值。

### 14.3 矢量数据统计

矢量数据统计指的是：对矢量数据中空间要素的空间位置及其属性进行统计计算，以获得空间要素分布的特征。

这种空间特征既可能是空间要素位置上的统计特征，也可能是空间要素特定属性在空间上的分布特征。

#### 14.3.1 平均最近邻近分析

平均最近邻分析主要用来研究空间要素在**空间分布上的特征**，或者叫做**空间分布模式**。

平均最近邻分析属于**检验性分析**，用来检验空间要素属于哪一种空间分布模式：

（1）集聚：点要素都是互相靠近聚在一起的；

（2）离散：点要素在空间中都相隔得很远，互相不靠近；

（3）随机：这种分布模式通常看不出有什么整体上的规律，既不像集聚，也不像离散，有的地方分布稀疏，有的地方分布密集；

平均最近邻分析会计算一个被称为**最近邻指数**的统计量：如果指数**等于1**，可能属于随机分布模式；如果指数**小于1**，可能属于集聚分布模式；如果指数**大于1**，可能属于离散分布模式；

最近邻指数是**观测平均距离**和**预期平均距离**的比值：

（1）观测平均距离：所有点要素两两之间距离的均值，也就是**任意两点间平面直线距离的均值**；

（2）预期平均距离：随机分布的点之间距离的均值；

也就是说，平均最近邻分析的前提是：**假设是为随机分布模式**，然后拿观测的点的距离和随机分布的点的距离相比。

平均最近邻分析一般提供5个统计值，除了观测平均距离、预期平均距离、最近邻指数外，还有2个：

（1）**Z得分**：离开均值的标准差的倍数；标准差表示的是数据聚集在均值附近的程度；Z得分为1就是+1个标准差的数值，Z得分为-1.65就是-1.65倍标准差倍数；

（2）**P值**：指的是概率值；在假设检验方法中，P值用来检验一个**零假设**成立的可能性，它与Z得分有着对应的关系；

零假设，又称原假设，通常就是在进行假设检验之前，先假设某些现象是属于随机分布的，然后用P值来检验零假设成立的可能性有多大，**若P值大则接受零假设**，若P值小则拒绝零假设。

通常在统计检验中，人们会设定P值为0.1，0.05，0.01这样几个不同的检验**显著性水平**，对应的Z得分分别是±1.65，±1.96，±2.58。

显著性水平可以反映假设检验中当零假设为正确时，人们却把它错误地拒绝了的概率或风险。它是小概率事件的概率值。

用户需要在每一次统计检验之前确定具体采用哪一个P值。

#### 14.3.2 空间自相关分析——全局莫兰指数

空间自相关性分析指的是对空间要素的属性数据的空间分布规律进行分析。

空间自相关性通常有三种模式：

（1）空间正自相关：空间距离上邻近的事物，它们的某项属性数值也是彼此相似的；换言之，性质相近的事物在空间上也彼此相近，即存在集聚现象；

（2）空间负自相关：空间距离上邻近的事物，它们的某项属性数值彼此不同；这说明存在空间上的某种竞争关系，属性数值相似的事物彼此排斥，而数值差异大的则可以共存；

（3）空间零自相关：无法判断某种现象有没有自相关性这种空间效应，其数值在空间上呈现一种随机的分布模式；

空间自相关性用全局莫兰指数来检验，它先假设一个地区整体上空间分布是零自相关的，即随机的，然后计算全局莫兰指数、Z得分和P值。根据这些数值，可以分析出三种情况：

（1）如果全局莫兰指数值大于零，且Z得分和P值满足设定的显著性水平，那么它为空间正自相关；

（2）如果全局莫兰指数值小于零，且Z得分和P值满足设定的显著性水平，那么它为空间负自相关；

（3）如果全局莫兰指数值接近零，且Z得分和P值都不满足设定的显著性水平，那么它为空间零自相关；

#### 14.3.3 集聚与离群分析——局部莫兰指数

全局莫兰指数把整个区域的空间自相关性用一个指数来检验，如果要了解区域内局部的空间自相关情况，就需要用集聚与离群分析，其指标为安塞林局部莫兰指数。

局部莫兰指数也可被称为一种空间关联的局部指标。

集聚与离群分析能够为每一个空间要素计算其局部莫兰指数及其Z得分与P值。

P值用来检验其是否满足用户事先假设的显著性水平，若P值不满足显著性水平，则属于不显著的空间要素；若P值满足显著性水平，则可以进一步划分出四种不同的组合形式：

（1）高值与高值集聚：局部莫兰指数值大于0，Z得分大于0；

（2）低值与低值集聚：局部莫兰指数值小于0，Z得分大于0；

（3）低值-高值离群：简称离群低值，表示一个低值周围是高值环绕，其局部莫兰指数大于0，Z得分小于0；

（4）高值-低值离群：简称离群高值，表示一个高值周围是低值环绕，其局部莫兰指数小于0，Z得分小于0；

#### 14.3.4 热点分析

热点分析所要解决的问题是：在一片数值空间分布中，找出那些显著的极高值（热点所在的位置），以及显著的极低值（冷点所在的位置）；

热点分析首先通过计算P值来检验各个空间要素的数据是否符合热点或冷点的显著性水平，即是否能够拒绝随机分布的零假设。然后再判断哪些符合显著性水平的空间要素，如果Z得分高，就说明是热点，如果Z得分低，就说明是冷点。

## 第15章 空间分析——应用模型

应用模型是使用GIS方法来解决具体的实际地理问题的操作流程或计算步骤。

### 15.1 综合性空间分析应用

综合性空间分析应用指的是：GIS的应用人员在GIS软件的支持下，把一系列空间分析方法综合在一起，来解决某个空间应用问题。

#### 15.1.1 选址分析应用

选址分析应用，通常就是为某个建设项目选定一个**适当的建设场地**。

例如，建设一个新工厂的选址，属于选址分析应用。

##### 15.1.1.1 选址的目的和要求

选址只有满足了**预定的目标和要素**，才能算是一个比较好的方案。

例如，工厂的选址有以下三个目标和要素：（1）距离现有道路200m以内；（2）距离几所学校1000m以外；（3）土地覆盖类型是灌木林地；

##### 15.1.1.2 选址的空间数据

（1）道路通常是线要素的矢量数据；

（2）学校的空间位置采用点要素的矢量数据；

（3）土地覆盖类型是采用面要素的矢量数据；

##### 15.1.1.3 选址的空间分析

针对三个目标，进行以下分析步骤：

（1）基于线要素的空间缓冲区分析：把距离道路200m以内的空间范围计算出来；

（2）点击点要素的空间缓冲区分析：把距离学校1000m以内的空间范围计算出来；

（3）矢量叠置分析中擦除：以道路缓冲区作为输入数据，以学校缓冲区作为叠置数据，进行擦除计算；

（4）在矢量多边形的土地覆盖类型数据离根据属性进行提取，即可找到灌木林地的范围；

（5）对几个计算的结果进行交集计算，得到最终结果；

#### 15.1.2 土地适宜性评价

土地适宜性评价，就是评估某种土地利用规划的事宜性。

例如，在某个地区新建一所学校，需要根据土地适宜性评价来决定其选址。

##### 15.1.2.1 评价的目标和要求

假设学校选址所要满足的目标有三个：（1）距离既有的学校尽量远；（2）人口密度尽量大；（3）地形坡度尽量缓；

##### 15.1.2.2 评价的空间数据

（1）既有学校的分布位置是点要素的矢量数据；

（2）人口密度是点要素数据，点符号的大小是其人口数量等级；

（3）地形坡度是栅格形式的数字高程模型；

##### 15.1.2.3 评价的空间分析

土地适宜性评价采用一种**多准则评价**（MEC）方法，使用**多个因子的评分数值通过加权叠加**来评价哪些地方适宜某种土地利用方式。

以学校选址为例，前述三个目标涉及三个因子：

（1）新建学校到既有学校的空间距离；

（2）人口密度；

（3）地形坡度；

根据各个适宜性因子的计算结果，指定一个评分标准，简单起见，将三个因子的评分定为三个等级，三级适宜性最高：

（1）对于新建学校到既有学校的空间距离，0~1500m为一级；1500~3000m为二级；3000~4500m为三级；

（2）对于人口密度，0~1500人（每平方公里）为一级；1500~3000人为二级；大于3000人为三级；

（3）对于地形坡度，30~90度为一级；15到30度为二级；0到15度为三级；

通过栅格数据重分类，分别对三个因子进行适宜性评分，生成三个因子的评分栅格数据，其中，某个栅格单元都有针对三个不同因子的适宜性评分；

**加权叠加**就是根据适宜性评价中每个因子的相对重要性设定权重，针对每个栅格单元中各个不同因子的评分，分别乘以其权重，再求和，最终得到综合了所有因子的评分数值；

比如，设置人口密度之权重为40%，设置新建学校到既有学校的空间距离和地形坡度之权重分别为30%，则综合性评分为：

![img](../../../assets/intro-of-gis-et4-note/适宜性评分.png)

在最后得到的结果数据中，栅格数值表示的是多因子评价的土地适宜性；

### 15.2 制图建模

前文所述的再GIS软件中按步骤执行空间分析功能，并实现综合性空间分析的过程还存在一些不足之处：

（1）需要手动地在GIS软件用户界面上操作各项步骤；

（2）如果某个步骤出现人为操作上的失误，则将面临后续所有步骤需要重新操作；

（3）如果需要将分析过程应用到其他问题，则需要将全部步骤重新操作一遍；

#### 15.2.1 制图建模的概念

GIS的**应用模型**就是针对具体的地理空间应用问题和目标，将GIS的解决方案编制成计算机中可以自动执行的流程，让计算机中的GIS软件自动地执行该流程，从而得到分析结果。

应用模型的优点：

（1）空间分析的操作步骤完全由GIS软件自动执行，不需要人为干预；

（2）出现的错误的时候可以暂停执行，便于修改错误之后再继续执行；

（3）需要推广应用到其他地方时，只要替换输入数据，就可以自动实现；

建立应用模型的原理、方法和过程，就称为**制图建模**。称其为制图建模的原因在于：应用模型中的输入、处理和输出的数据通常都是可以用地图的图形来表达的空间数据，即模型中的数据流是空间数据流，这些数据是矢量的点、线、面，或者栅格等可以表现为地图图形的形式；

#### 15.2.2 制图建模的步骤

（1）明确应用问题的目标、要求；

（2）确定应用需求的结果形式；

（3）从结果开始，**逆向推导**所需的空间分析方法和空间数据；

（4）将分析流程按顺序编制成可执行的计算机指令；

（5）代入输入的空间数据，运行应用模型的计算机指令；

（6）检验生成的结果；

#### 15.2.3 制图建模的方法

以计算某个校园内坡度大于15度的区域占校园总面积的比重为例子，说明逆向推导过程：

（1）要想得到坡度大于15度的面积占整个校园面积的比例，需要用坡度大于15度区域的面积除以整个校园的面积；

（2）整个校园的面积可以用校园范围（矢量多边形数据）通过计算面积的GIS功能得到；

（3）坡度大于15度的区域的面积可以用坡度大于15度的区域范围（栅格数据）通过计算面积得到；

（4）坡度大于15度的区域可以通过将栅格形式的坡度数据重分类得到；

（5）栅格坡度数据可以通过对栅格DEM数据进行坡度分析得到；

（6）栅格DEM和校园范围数据就是整个应用模型的输入数据；

#### 15.2.4 制图建模的工具

制图建模的工具指的是在GIS软件中将应用模型转变成**可以执行的计算机指令**的工具软件；

##### 15.2.4.1 脚本语言

常见的GIS软件都提供了一些简单易用的称为脚本语言的**内置建模语言**；

GIS软件一般都会提供一种脚本语言的编程窗口；

QGIS和ArcGIS软件中所使用的Python语言是脚本语言的代表性语言之一，它具有以下显著特点：

（1）Python是一种解释型语言，无需编译即可执行；

（2）Python是一种交互式语言，每输入一句命令的源代码，Python会立即解释执行，用户可立即得到反馈结果；

（3）Python是一种面向对象语言；

##### 15.2.4.2 可视化制图建模工具

可视化制图建模工具可以解决应用模型中需要编写复杂程序的问题；用户可以一种所见即所得的方式，或者说形象化的方式来构建应用模型，而不需要编写代码。

可视化制图建模工具大大降低了不同专业领域的人员使用GIS建模的技术门槛。

## 第16章 GIS制图输出

### 16.1 地图的基本概念

GIS的工作流程常常起始于地图而又终止于地图，地图是GIS空间数据的可视化。

地图是一种把空间实体描画在纸面等平面上的图形。它包括三个特征：（1）遵循一定的数学法则；（2）使用一套特定的图形符号和文字注记；（3）经过适当的简化概括。

#### 16.1.1 地图的数学法则

地图的数学法则指的是地图所具有的**几何性质**，表现在比例尺、地图投影及坐标系两个方面。

##### 16.1.1.1 比例尺

所有的地图都是把地球表现的某一个区域按照一定的比例缩小绘制。按比例缩小就是要设定一个确定的比例尺。

##### 16.1.1.2 地图投影及坐标系

地图投影及坐标系用来建立地球曲面和地图平面坐标系之间的联系。

#### 16.1.2 地图的图形符号和文字标记

图形符号在地图上的位置代表了空间实体的地理位置；图形符号的形状、大小和颜色等代表了地理实体的某种属性；

地图的文字注记用来在地图上进一步说明空间实体的某些性质，例如，地名、等高线的高程值等；

##### 16.1.2.1 符号的形状

符号的形状指的是符号的**几何外形**；

符号的形状通常用来区别不同性质的空间数据，例如，用不同的线形来表示公路和铁路；

##### 16.1.2.2 符号的尺寸

符号的尺寸反映了不同空间实体相对的数量和质量上的差异；

例如，较大的圆形符号表示人口较多的城市，较小的圆形符号表示人口较少的城市；

##### 16.1.2.3 符号的颜色

地图上的图形符号可以用不同的颜色来区分空间实体在质量和数量上的差别；

颜色这种视觉变量在GIS中通过颜色模型来设定，具体地，包括RGB颜色模型、HSV颜色模型；

##### 16.1.2.4 注记的字体

地图上的文字注记通常由多种变化形式，用来表达空间实体质量和数量上的差异；

文字注记的变化形式体现在字体、字重、字宽和正体与斜体等方面；

地图上不同的空间实体会采用不同的字体来生成注记；一般对于城市那样的点状空间实体采用黑色等线体表达，对于河流湖泊等水体则采用蓝色左斜宋体表达；

##### 16.1.2.5 注记的位置

地图上的文字注记分为两种：（1）空间的实体属性，称为标注；（2）图名和图例中的文字，由用户设定其在地图上的位置；

对于点状空间实体的标注（如地名），一般优先使其处于点状空间实体地图符号的右上方；

对于线状空间实体的标注（如河流），一般沿着线的方向进行自动标注；

对于面状空间实体的标注（如行政区），一般将其放置于面状符号的内部；

#### 16.1.3 制图综合

对地理现象进行简化和概括，在地图学中称为制图综合或地图综合。通常用到以下方法：

（1）选取：重要的空间实体选中画在地图上，不重要的则舍弃；比如，小比例的中国地图上，只绘制长江、黄河等大河；

（2）简化：把空间实体的几何形状变得简单，主要特征保留，次要特征舍弃；比如，仅保留河流上的大的弯曲；

（3）概括：整合邻近的相似的空间实体；例如，在城市地图中，将位置相近的建筑物合并；

（4）夸张：人为地方大某些空间实体的一部分区域，以突出其空间特征；比如，钓鱼岛；

（5）移位：略微移动某些空间实体在地图上的位置，以避免和相邻的空间实体在图形上相互重叠；

#### 16.1.4 地图的组成要素

##### 16.1.4.1 地图主体要素

地图主体要素，就是地图中表现空间实体的图形符号，还包括文字注记，通常占据了地图幅面的主要部分。

##### 16.1.4.2 地图数学要素

地图数学要素，包括地图投影、坐标系、图廓、比例尺、指北箭头等图形符号。

##### 16.1.4.3 地图辅助要素

地图辅助要素，包括图名、图例、插图、统计图表、图像，以及说明性文字等。

### 16.2 地图学与地图分类

#### 16.2.1 地图学

地图学是研究地图基础理论、地图制作技术和地图使用方法的学科。

##### 16.2.1.1 古代地图学阶段

古代地图学的制图思想主要就是对各种空间实体的位置和属性进行图形化表达；

该阶段主要的地图形式通常都是类似于地形图的**普通地图**；

##### 16.2.1.2 近代地图学阶段

近代地图学阶段开始于地理大发现阶段，通过科学靠查各种自然或社会经济现象的地理分布范围，然后通过这种分布来研究它们的地理特征和内在规律；

该阶段的地图形状通常都是**专题地图**；

##### 16.2.1.3 现代地图阶段

现代地图学阶段开始于信息化时代，以GIS和计算机地图制图为主要标志；

现代地图学主要用**系统的思想**来看待环境，认为各种自然因素都是相互联系、相互影响的，所以不能把它们分割开；

该阶段产生了一些表达抽象概念的地图，如敏感性地图、可达性地图、可持续性地图、适宜性地图等；

此外，现代遥感技术的发展产生了影像地图；三维计算机图形学的发展则实现了可以表达地形和建筑的三维透视场景图；

#### 16.2.2 地图分类

地图分为普通地图和专题地图两大类；

##### 16.2.2.1 普通地图

普通地图要求尽量多地把各种地理空间现象部分主次地表达在地图上；

普通地图主要是地形图和普通地理图；

##### 16.2.2.2 专题地图

专题地图用来表达某一种地理空间现象；

专题地图分为两大类：表达质量分布的地图、表达数量分布的地图；

表达质量分布的地图通常采用**质底法**的表现方法，比如行政区划图——不同的行政区内部采用一种特定的颜色或图案填充，以和其他的行政区相区别；

表达数量分布的地图，由多种不同形式的表现方法：

（1）等值区域图：按照行政区划范围进行绘制的专题地图，通常是选择行政区划的属性数据中某个属性值（如行政区的人口数）并将其按照数值大小分成几个级别，对不同的级别以不同深浅的颜色表现其数值的大小；

（2）分布密度图：相比于等值区域图，分区密度图对数据分布的表示更加准确，它使用更小的人口统计单元，去除大面积水体区域，使人口密度分布比等值区域图显得更加精细、更加合理；

（3）分级符号图：采用不同大小的地图符号（如圆形、正方形）来表示不同等级的数量分布；

（4）比例符号图：相对于分级符号图，比例符号图不对数量进行分级，而是根据实际数量的多少，相应地按比例形成地图符号，符号的面积与实际数量成正比；

（5）分区统计图：在各个分区中放置统计图来表示各个分区某些统计数量的专题地图；通常采用柱状图地图、饼状图地图来表现数量的大小；

（6）点值图：使用大小均一的点符号填充在区域中，以此来表示该区域中的某种统计数量的多少；

（7）等值线图：表示某种数量在空间中起伏分布的统计曲面，比如等雨量图、等温线图、等压线图；

（8）流向图：表示不同的地理单元之间各种形式的物质和人员的流动数量；一般使用不同宽度的线条来表达流动数量的大小；

### 16.3 GIS地图制图

运用GIS软件进行专题地图制图主要考虑五个基本问题：

（1）准备合适的底图数据和专题数据；

（2）选择合适的专题地图表现方法；

（3）选择合适的制图数据分级方法；

（4）选择合适的地图颜色渐变方案；

（5）设计合适的地图版面布局；

#### 16.3.1 底图数据与专题数据

底图数据可以分为两部分：

（1）放在地图**最下层**作为背景的数据层；

（2）放在地图**最上层**作为参考的数据层；

而专题数据则放在背景数据层和参考数据层**之间**，主要用来生成专题信息的空间和属性数据；

#### 16.3.2 选择表现方法

在专题地图上表现同一种现象可以使用多种不同的方法；

例如，在表现人口分布的时候，可以使用等值区域图、分区密度图等多种表现方法；

#### 16.3.3 选择数据分级方法

制作表达数量分布的专题地图时，需要对不同的数量进行分级。

##### 16.3.3.1 等间距分级方法

等间距分级方法将某一属性值整个数值范围等分成用户指定数目的级别，其中每两个相邻级别的**数值间隔是相等的**。

##### 16.3.3.2 分位数分级方法

分位数分级方法，也称为等数量分级方法，它把相同数量的数据分配到每一个级别中，也就是使得每个级别中**包含相同个数的数据**。

##### 16.3.3.3 标准差分级方法

标准差分级方法首先计算出所有属性值的均值和标准差，然后把级别在均值上下分成若干个数值范围，即低于均值一个标准差以内，低于均值一个标准差到两个标准差之间等。

##### 16.3.3.4 自然断点分级方法

自然断点分级方法，也成为Jenks自然断点分级方法，它可以最大程度地减少同一类数据值之间的差异，并最大程度地扩大类别之间的差异。

#### 16.3.4 地图颜色渐变方案

在选择好数据分级方法以后，就要对不同级别的数据选择不同深浅的颜色进行标识。

在地图中，通常使用明度较高的浅色（如白色）表示属性数值较小的空间实体，使用明度较低、饱和度较高的深色表示属性数值较大的空间实体。

##### 16.3.4.1 单色渐色方案

单色渐变方案由用户指定一种明度较低、饱和度较高的色调，进而逐步降低明度、增加饱和度，以形成一个颜色序列。

##### 16.3.4.2 双端色渐变方案

双色渐变方案相当于两个单色渐变方案的组合，通常用来表示属性数值有正负之分的现象，比如温度。

##### 16.3.4.3 光谱色渐变方案

光谱色渐变方案包括两种：部分光谱色渐变方案、全光谱色渐变方法；它们都是按照可见光波长数值从小到大顺序排列的颜色序列。

光谱色渐变方案在饱和度与明度较低的情况下，通常用来表达地形高程的变化，例如，海域用蓝色、平原丘陵用绿色，中山用黄色，高山高原用棕色。

##### 16.3.4.4 明度渐变方案

明度渐变方案通常是在制作单色地图时使用，即使用一些列饱和度为0，而明度值逐渐递减的颜色系列（从白到灰、最后到黑）来表示地图上数量的变化。

##### 16.3.4.5 混合色渐变方案

混合色渐变方案有用户指定两种特定的颜色，在RGB模型或HSV模型所形成的颜色空间中，由GIS软件在两种颜色的坐标之间进行插值，生成混合两种颜色的一系列颜色。

该颜色序列方案通常用来在地图上表达类似不同民族人口混合比例的情况。

#### 16.3.5 地图版面布局

版面指的就是地图的幅面，也就是使用GIS软件设计好地图后，可以通过绘图仪或打印机将地图输出到纸面上，这个纸面的大小就是通过版面来设置的。版面的方向有纵向、横向两种。

布局指的是用户在确定了尺寸的版面上合理放置地图各个组成要素的工作。这些要素包括：地图的主体要素、图名、图例、图解比例尺、指北箭头、属性表格和说明性文字等。